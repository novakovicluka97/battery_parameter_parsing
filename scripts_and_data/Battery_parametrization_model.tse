version = 4.2

//
// Saved by sw version: 2023.1 DEV
//

model "Battery_parametrization_model" {
    configuration {
        hil_device = "VHIL+"
        hil_configuration_id = 1
        simulation_method = exact
        simulation_time_step = 20e-6
        simulation_discret_scaling = 1
        dsp_timer_periods = 100e-6, 50e-3
        ss_calc_method = "systematic elimination"
        enb_pole_shift = False
        enb_gds_oversampling = False
        show_modes = False
        device_ao_limit_enable = False
        reset_analog_outputs_on_sim_stop = True
        reset_digital_outputs_on_sim_stop = True
        vhil_adio_loopback = False
        cpl_stb = False
        enb_dep_sw_detect = False
        code_section = "internal memory"
        data_section = "internal memory"
        sys_sp_rate_1 = 0.01
        sys_sp_rate_2 = 0.05
        sys_real_type_precision = "default"
        user_real_type_precision = "default"
        sys_cpu_optimization = "high"
        user_cpu_optimization = "high"
        user_cpu_part_option = "default"
        matrix_based_reduction = True
        cpl_dynamics_analysis = False
        export_ss_to_pickle = False
        ground_scope_core = False
        dss_num_tol = 1e-15
        cce_platform = "generic"
        cce_use_relative_names = False
        cce_type_mapping_real = "double"
        cce_type_mapping_uint = "unsigned int"
        cce_type_mapping_int = "int"
        cce_directory = ""
        cce_custom_type_int = ""
        cce_custom_type_uint = ""
        cce_custom_type_real = ""
        tunable_params = "component defined"
        sp_compiler_type = "C compiler"
        sig_stim = "off"
        export_resource_list = ""
        export_dependency_list = ""
        export_out_file = ""
        export_lock_top_level = True
        export_encrypt_library = True
        export_encrypt_resources = True
    }

    component Subsystem Root {
        component gen_c_function "C function1" {
            global_variables = "real next_sw;real counter_cooldown;real first_time_step_flag;"
            init_fnc = "/*Begin code section*/
script_no = 1;  // start with the first script
sw_select = 1;  // start with first sw permutation (1st script)
timer = 0;
counter_cooldown = counter_cooldown_max;  // wait an hour for the
// battery to go back to its original temperature [instant with typhoon] 
// and to discharge the RC capacitors
first_time_step_flag = 1;  // This flag exists because vcell measurement
// will always start with 0. We need to prevent even looking at that false vcell.
temperature = test_temp;
/*End code section*/"
            input_terminals = "real test_temp;real Vcell;"
            input_terminals_dimensions = "inherit;inherit"
            input_terminals_feedthrough = "True;True"
            input_terminals_show_labels = "True;True"
            output_fnc = "/*Begin code section*/
// The model starts immediately with time and script_no 1
// sw_select = 1
// script_no = 1

if (sw_select == 0) {
    counter_cooldown--;
    if (counter_cooldown <= 0) {
        sw_select = next_sw;
        counter_cooldown = counter_cooldown_max;
    }
}
else {  // (sw_select != 0)
    timer += Ts;
    if (Vcell < Vmin_25 && sw_select == 1 && first_time_step_flag != 1) {
        // Start second script countdown
        // Usually we would wait for the batteries and the chamber to cool off back to 25 degrees 
        script_no = 2;  // second script
        sw_select = 0;  // zero current
        next_sw = 2;
        temperature = 25;  // default temperature
        timer = 0;
    }
    else if (timer > TITHER_DISCHARGE_STOP_TIME && sw_select == 2){
        timer = 0;
        if (Vcell < Vmin_25) {
            // Start third script
            script_no = 3;
            sw_select = 3;
            temperature = test_temp;
        }
    }
    else if (Vcell > Vmax_25 && sw_select == 3) {
        // Start forth script countdown
        // Usually we would wait for the batteries and the chamber to cool off back to 25 degrees 
        script_no = 4;
        sw_select = 0;  // zero current
        next_sw = 4;
        timer = 0;
    }
    else if (timer > TITHER_CHARGE_STOP_TIME && sw_select == 4){
        timer = 0;
        if (Vcell > Vmax_25) {
            // Start forth script countdown
            // Usually we would wait for the batteries and the chamber to cool off back to 25 degrees 
            sw_select = 0;  // zero current
            script_no = 5;
            next_sw = 0;
        }
    }
}

first_time_step_flag = 0;
/*End code section*/"
            output_terminals = "real sw_select;inherit temperature;inherit timer;inherit script_no;"
            output_terminals_dimensions = "inherit;inherit;inherit;inherit"
            output_terminals_feedthrough = "True;True;True;True"
            output_terminals_show_labels = "True;True;True;True"
            parameters = "real Vmin_25;real Vmax_25;real Ts;real TITHER_CHARGE_STOP_TIME;real TITHER_DISCHARGE_STOP_TIME;real counter_cooldown_max;"
        }
        [
            position = 8400, 8088
            hide_name = True
            size = 176, 160
        ]

        component gen_probe sw_select_1 {
        }
        [
            position = 8600, 7960
        ]

        component src_clock Clock1 {
            execution_rate = "Ts"
        }
        [
            position = 6944, 8376
            hide_name = True
        ]

        component gen_probe Time {
        }
        [
            position = 7104, 8376
        ]

        component gen_c_function "C function10" {
            global_variables = "real next_sw;real first_time_step_flag;real counter_cooldown;"
            init_fnc = "/*Begin code section*/
script_no = 1;  // start with the first script
sw_select = 1;  // start with first sw permutation (1st script)
timer = 0;
counter_cooldown = counter_cooldown_max;
 // wait an \"hour\" for the
// battery to go back to its original temperature [instant with typhoon] 
// and to discharge the RC capacitors
first_time_step_flag = 1;  // This flag exists because vcell measurement
// will always start with 0. We need to prevent even looking at that false vcell.
temperature = input_temp;
/*End code section*/"
            input_terminals = "real input_temp;real Vcell;"
            input_terminals_dimensions = "inherit;inherit"
            input_terminals_feedthrough = "True;True"
            input_terminals_show_labels = "True;True"
            output_fnc = "/*Begin code section*/
if (sw_select == 0) {  // Resting the battery cell
    counter_cooldown--;
    if (counter_cooldown <= 0) {
        sw_select = next_sw;
        counter_cooldown = counter_cooldown_max;
    }
}
else {  //  (sw_select != 0) 
    timer += Ts;
    if (timer >= DYN_PROFILE_STOP_TIME && sw_select == 1){
        // This part triggers when the LUT attached to sw_select finishes with its dynamic profile
        // Consequently, the profile starts again by resetting the timer to 0
        timer = 0;
    }
    if (Vcell < V_end_script_1 && first_time_step_flag != 1 && sw_select == 1){
        // If battery cell reached less than roughly 10% of SOC, stop the dynamic profile injection
        // This is to prevent possible undervoltage with high current peaks
        sw_select = 0;
        next_sw = 2;
        temperature = 25;  // And remains so for the rest of the scripts
        script_no = 2;
    }
    else if (Vcell <= Vmin_25 && sw_select == 2){
        sw_select = 3;  // Tither profiles
        if (do_dyn_tither > 0.5){  // do dynamic tither
            timer = 0;  // Refresh timer
        }
        else {  // skip dynamic tither profiles by setting the timer to the last value
            timer = TITHER_DISCHARGE_STOP_TIME;
        }
    }
    if (timer >= TITHER_DISCHARGE_STOP_TIME && sw_select == 3){
        timer = 0;
        if (Vcell < Vmin_25) {
            // If battery cell reached less than Vmin_25, stop the tither profile injection
            sw_select = 4;
            script_no = 3;
            // No need to rest the battery cell
            // Constant current charging of the battery cell with C/1
        }
    }
    else if (sw_select == 4 && Vcell > Vmax_25){  // Constant current charge reached Vmax_25
        sw_select = 5;  // Tither profiles
        timer = 0;  // Refresh timer
    }
    else if (sw_select == 5 && timer >= TITHER_CHARGE_STOP_TIME){
        timer = 0;  // Refresh timer
        if (Vcell > Vmax_25){
            sw_select = 0;
            script_no = 4;
            next_sw = 0;
        }
    }
}

first_time_step_flag = 0;
/*End code section*/"
            output_terminals = "real sw_select;inherit temperature;inherit timer;inherit script_no;"
            output_terminals_dimensions = "inherit;inherit;inherit;inherit"
            output_terminals_feedthrough = "True;True;True;True"
            output_terminals_show_labels = "True;True;True;True"
            parameters = "real Vmin_25;real Vmax_25;real V_end_script_1;real counter_cooldown_max;real DYN_PROFILE_STOP_TIME;real TITHER_DISCHARGE_STOP_TIME;real TITHER_CHARGE_STOP_TIME;real Ts;real do_dyn_tither;"
        }
        [
            position = 8416, 8464
            hide_name = True
            size = 176, 160
        ]

        component src_constant DYN_DIS_CHG {
            execution_rate = "Ts"
            value = "DYN_DIS_CHG"
        }
        [
            position = 6944, 8680
        ]

        component src_constant DYN_CHG {
            execution_rate = "Ts"
            value = "DYN_CHG"
        }
        [
            position = 6944, 8744
        ]

        component gen_gain Gain1 {
            gain = "SIMULATION_SPEED_UP"
        }
        [
            position = 7016, 8376
            hide_name = True
        ]

        component src_constant STA_DIS_CHG {
            execution_rate = "Ts"
            value = "DISCHG_RATE"
        }
        [
            position = 6944, 8024
        ]

        component src_constant STA_CHG {
            execution_rate = "Ts"
            value = "CHG_RATE"
        }
        [
            position = 6944, 8088
        ]

        component gen_probe dyn_sw_select_1 {
        }
        [
            position = 8680, 8328
        ]

        component gen_c_function "C function17" {
            init_fnc = "/*Begin code section*/
done_flag = 0;
/*End code section*/"
            input_terminals = "real sta1;inherit sta2;inherit sta3;inherit dyn1;inherit dyn2;inherit dyn3;"
            input_terminals_dimensions = "inherit;inherit;inherit;inherit;inherit;inherit"
            input_terminals_feedthrough = "True;True;True;True;True;True"
            input_terminals_show_labels = "True;True;True;True;True;True"
            output_fnc = "/*Begin code section*/
if (sta1 > 4.5 && sta2 > 4.5 && sta3 > 4.5 && dyn1 > 3.5 && dyn2 > 3.5 && dyn3 > 3.5 ) {
    done_flag = 1;
}
else {
    done_flag = 0;
}
/*End code section*/"
            output_terminals = "real done_flag;"
            output_terminals_dimensions = "inherit"
            output_terminals_feedthrough = "True"
            output_terminals_show_labels = "True"
        }
        [
            position = 7088, 8240
            hide_name = True
            size = 96, 152
        ]

        component gen_probe done_flag {
        }
        [
            position = 7320, 8240
        ]

        component gen_delay Delay1 {
            del_length = "2000"
        }
        [
            position = 7224, 8240
            hide_name = True
        ]

        component gen_delay Delay2 {
        }
        [
            position = 7032, 8024
            hide_name = True
        ]

        component gen_delay Delay3 {
        }
        [
            position = 7032, 8088
            hide_name = True
        ]

        component gen_delay Delay4 {
        }
        [
            position = 7016, 8680
            hide_name = True
        ]

        component gen_delay Delay5 {
        }
        [
            position = 7016, 8744
            hide_name = True
        ]

        component Subsystem static_25 {
            layout = dynamic
            component "core/Voltage Measurement" voltage_ {
                execution_rate = "Ts"
                sig_output = "True"
                signal_access = "Inherit"
            }
            [
                position = 8008, 8288
                rotation = right
                scale = -1, 1
                size = 64, 32
            ]

            component gen_probe script_no {
            }
            [
                position = 7904, 8488
            ]

            component sys_mp_signal_switch "Multiport signal switch1" {
                number_of_input_terminals = "4"
            }
            [
                position = 8144, 8160
                hide_name = True
            ]

            component lut_1d "1D look-up table23" {
                in_vec_x = "TIME_TITHER_DISCHARGE"
                out_vec_f_x = "CURRENT_TITHER_DISCHARGE"
                table_impl = "Non-equidistant"
            }
            [
                position = 7920, 8160
                hide_name = True
            ]

            component lut_1d "1D look-up table25" {
                in_vec_x = "TIME_TITHER_CHARGE"
                out_vec_f_x = "CURRENT_TITHER_CHARGE"
                table_impl = "Non-equidistant"
            }
            [
                position = 7920, 8192
                hide_name = True
            ]

            component "core/Signal Controlled Current Source" Isp22 {
            }
            [
                position = 8312, 8288
                rotation = left
                hide_name = True
                scale = -1, 1
                size = 64, 32
            ]

            component "core/Current Measurement" current_ {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8248, 8256
                rotation = down
                scale = 1, -1
                size = 64, 32
            ]

            component gen_integrator Integrator1 {
                show_reset = "either"
            }
            [
                position = 8464, 8048
                hide_name = True
            ]

            component gen_probe chgAh {
            }
            [
                position = 8560, 8048
            ]

            component gen_integrator Integrator2 {
                show_reset = "either"
            }
            [
                position = 8464, 8112
                hide_name = True
            ]

            component gen_probe disAh {
            }
            [
                position = 8560, 8112
            ]

            component gen_c_function "C function2" {
                init_fnc = "/*Begin code section*/
out = 0;
out2 = 0;
/*End code section*/"
                input_terminals = "real current;"
                input_terminals_dimensions = "inherit"
                input_terminals_feedthrough = "True"
                input_terminals_show_labels = "False"
                output_fnc = "/*Begin code section*/
if (current>0) {
    out = current;
    out2 = 0;
}
else if (current<0) {
    out2 = -current;
    out = 0;
}
else {
    out2 = 0;
    out = 0;
}
/*End code section*/"
                output_terminals = "real out;inherit out2;"
                output_terminals_dimensions = "inherit;inherit"
                output_terminals_feedthrough = "True;True"
                output_terminals_show_labels = "False;False"
            }
            [
                position = 8368, 8080
                hide_name = True
                size = 48, 48
            ]

            component gen_probe temperature {
            }
            [
                position = 7952, 8408
            ]

            component gen_gain Gain2 {
                gain = "SIMULATION_SPEED_UP"
            }
            [
                position = 7824, 8176
                hide_name = True
            ]

            component gen_gain Gain3 {
                gain = "SIMULATION_SPEED_UP"
            }
            [
                position = 8304, 8080
                hide_name = True
            ]

            component tm_delay "Unit Delay1" {
            }
            [
                position = 7856, 8488
                hide_name = True
            ]

            component gen_probe current {
            }
            [
                position = 8560, 8176
            ]

            component tm_delay "Unit Delay7" {
            }
            [
                position = 8352, 8112
                hide_name = True
            ]

            component "core/Rate Transition" "Rate Transition1" {
                execution_rate = "Ts_cell"
            }
            [
                position = 8096, 8296
                hide_name = True
                size = 32, 32
            ]

            component gen_probe voltage {
            }
            [
                position = 7960, 8240
            ]

            component "core/Battery Cell" "Battery Cell" {
                C1 = "C1"
                H_type = "One state"
                M = "M"
                M0 = "M0"
                Q_total = "total_Q"
                R0 = "R0"
                R1 = "R1"
                RC_NO = "1"
                T_vector = "T_vector"
                T_vector_h = "T_vector"
                execution_rate = "Ts_cell"
                gamma = "G"
                meas_OCV = "True"
                meas_SOC = "True"
                meas_diffusion = "True"
                meas_hyst = "True"
                thermal_flag = "False"
            }
            [
                position = 8160, 8304
                size = 32, 64
            ]

            port switch_select {
                position = left:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8128
            ]

            port voltage_meas {
                position = right:3
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 7760, 8288
                rotation = down
            ]

            port timer {
                position = left:3
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8176
            ]

            port cell_temperature {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8352
            ]

            port script_number {
                position = left:4
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8488
            ]

            tag From15 {
                value = "dischg"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 7984, 8144
                hide_name = True
                size = 60, 20
            ]

            tag From16 {
                value = "chg"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 7984, 8176
                hide_name = True
                size = 60, 20
            ]

            junction Junction155 sp
            [
                position = 7984, 8128
            ]

            junction Junction156 sp
            [
                position = 7872, 8352
            ]

            junction Junction104 sp
            [
                position = 7888, 8176
            ]

            junction Junction142 sp
            [
                position = 8416, 8112
            ]

            junction Junction154 sp
            [
                position = 8248, 8176
            ]

            junction Junction157 sp
            [
                position = 7880, 8288
            ]

            junction Junction158 pe
            [
                position = 8160, 8256
            ]

            connect Gain2.in timer as Connection898
            connect "Multiport signal switch1.ctrl" Junction155 as Connection899
            connect Junction155 switch_select as Connection900
            connect "Unit Delay7.in" Junction155 as Connection901
            connect Junction156 cell_temperature as Connection907
            [
                breakpoints = 7824, 8352
            ]
            connect temperature.in Junction156 as Connection908
            connect "Unit Delay1.in" script_number as Connection909
            connect "1D look-up table23.value" "Multiport signal switch1.in1" as Connection331
            connect "1D look-up table25.value" "Multiport signal switch1.in3" as Connection332
            connect Isp22.in "Multiport signal switch1.out" as Connection337
            connect Isp22.n_node current_.p_node as Connection390
            connect Integrator1.out chgAh.in as Connection392
            connect Integrator2.out disAh.in as Connection393
            connect "C function2.out" Integrator1.in as Connection395
            connect Integrator2.in "C function2.out2" as Connection417
            connect From16 "Multiport signal switch1.in2" as Connection465
            connect Junction104 "1D look-up table23.addr" as Connection469
            connect "1D look-up table25.addr" Junction104 as Connection470
            connect Gain2.out Junction104 as Connection753
            connect "C function2.current" Gain3.out as Connection754
            connect From15 "Multiport signal switch1.in" as Connection827
            connect Junction142 Integrator1.reset as Connection838
            connect Integrator2.reset Junction142 as Connection839
            connect script_no.in "Unit Delay1.out" as Connection860
            connect Gain3.in Junction154 as Connection891
            connect Junction154 current_.out as Connection892
            [
                breakpoints = 8248, 8176
            ]
            connect current.in Junction154 as Connection893
            connect "Unit Delay7.out" Junction142 as Connection895
            connect "Rate Transition1.in" Junction156 as Connection911
            connect voltage_.out Junction157 as Connection912
            connect Junction157 voltage_meas as Connection913
            connect voltage.in Junction157 as Connection914
            connect current_.n_node Junction158 as Connection916
            connect Junction158 voltage_.p_node as Connection917
            [
                breakpoints = 8168, 8256
            ]
            connect "Battery Cell.P" Junction158 as Connection918
            connect "Battery Cell.N" voltage_.n_node as Connection919
            connect Isp22.p_node "Battery Cell.N" as Connection920
            connect "Battery Cell.T" "Rate Transition1.out" as Connection921
        }
        [
            position = 8736, 8088
            size = 248, 160
        ]

        component src_constant TEST_TEMP_1 {
            execution_rate = "Ts"
            value = "25"
        }
        [
            position = 6944, 8440
        ]

        component src_constant TEST_TEMP_2 {
            execution_rate = "Ts"
            value = "45"
        }
        [
            position = 6944, 8496
        ]

        component src_constant TEST_TEMP_3 {
            execution_rate = "Ts"
            value = "5"
        }
        [
            position = 6944, 8552
        ]

        component Subsystem dynamic_25 {
            layout = dynamic
            component "core/Voltage Measurement" voltage_ {
                execution_rate = "Ts"
                sig_output = "True"
                signal_access = "Inherit"
            }
            [
                position = 7960, 8232
                rotation = right
                scale = -1, 1
                size = 64, 32
            ]

            component sys_mp_signal_switch "Multiport signal switch4" {
                number_of_input_terminals = "5"
            }
            [
                position = 8096, 8096
                hide_name = True
            ]

            component lut_1d "1D look-up table30" {
                in_vec_x = "DYN_TIME_PROFILE"
                out_vec_f_x = "DYN_CURRENT_PROFILE"
                table_impl = "Non-equidistant"
            }
            [
                position = 7952, 8072
                hide_name = True
            ]

            component "core/Signal Controlled Current Source" Isp25 {
            }
            [
                position = 8264, 8232
                rotation = left
                hide_name = True
                scale = -1, 1
                size = 64, 32
            ]

            component "core/Current Measurement" current_ {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8200, 8192
                rotation = down
                scale = 1, -1
                size = 64, 32
            ]

            component gen_integrator Integrator7 {
                show_reset = "either"
            }
            [
                position = 8432, 8008
                hide_name = True
            ]

            component gen_probe chgAh {
            }
            [
                position = 8528, 7992
            ]

            component gen_integrator Integrator8 {
                show_reset = "either"
            }
            [
                position = 8432, 8072
                hide_name = True
            ]

            component gen_probe disAh {
            }
            [
                position = 8528, 8072
            ]

            component gen_probe script_no {
            }
            [
                position = 7944, 8424
            ]

            component lut_1d "1D look-up table31" {
                in_vec_x = "TIME_TITHER_DISCHARGE"
                out_vec_f_x = "CURRENT_TITHER_DISCHARGE"
                table_impl = "Non-equidistant"
            }
            [
                position = 7952, 8104
                hide_name = True
            ]

            component lut_1d "1D look-up table32" {
                in_vec_x = "TIME_TITHER_CHARGE"
                out_vec_f_x = "CURRENT_TITHER_CHARGE"
                table_impl = "Non-equidistant"
            }
            [
                position = 7952, 8136
                hide_name = True
            ]

            component gen_probe temperature {
            }
            [
                position = 7944, 8352
            ]

            component gen_gain Gain4 {
                gain = "SIMULATION_SPEED_UP"
            }
            [
                position = 8248, 8040
                hide_name = True
            ]

            component gen_gain Gain9 {
                gain = "SIMULATION_SPEED_UP"
            }
            [
                position = 7856, 8104
                hide_name = True
            ]

            component gen_c_function "C function18" {
                init_fnc = "/*Begin code section*/
out = 0;
out2 = 0;
/*End code section*/"
                input_terminals = "real current;"
                input_terminals_dimensions = "inherit"
                input_terminals_feedthrough = "True"
                input_terminals_show_labels = "False"
                output_fnc = "/*Begin code section*/
if (current>0) {
    out = current;
    out2 = 0;
}
else if (current<0) {
    out2 = -current;
    out = 0;
}
else {
    out2 = 0;
    out = 0;
}
/*End code section*/"
                output_terminals = "real out;inherit out2;"
                output_terminals_dimensions = "inherit;inherit"
                output_terminals_feedthrough = "True;True"
                output_terminals_show_labels = "False;False"
            }
            [
                position = 8320, 8040
                hide_name = True
                size = 48, 48
            ]

            component tm_delay "Unit Delay6" {
            }
            [
                position = 7880, 8424
                hide_name = True
            ]

            component gen_probe current {
            }
            [
                position = 8528, 8136
            ]

            component tm_delay "Unit Delay12" {
            }
            [
                position = 8344, 8088
                hide_name = True
            ]

            component "core/Rate Transition" "Rate Transition1" {
                execution_rate = "Ts_cell"
            }
            [
                position = 8056, 8232
                hide_name = True
                size = 32, 32
            ]

            component gen_probe voltage {
            }
            [
                position = 7920, 8176
            ]

            component "core/Battery Cell" "Battery Cell" {
                C1 = "C1"
                H_type = "One state"
                M = "M"
                M0 = "M0"
                Q_total = "total_Q"
                R0 = "R0"
                R1 = "R1"
                RC_NO = "1"
                T_vector = "T_vector"
                T_vector_h = "T_vector"
                execution_rate = "Ts_cell"
                gamma = "G"
                meas_OCV = "True"
                meas_SOC = "True"
                meas_diffusion = "True"
                meas_hyst = "True"
                thermal_flag = "False"
            }
            [
                position = 8128, 8240
                size = 32, 64
            ]

            port switch_select {
                position = left:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8008
            ]

            port timer {
                position = left:3
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8104
            ]

            port cell_temperature {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8296
            ]

            port voltage_meas {
                position = right:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 7760, 8232
                rotation = down
            ]

            port script_number {
                position = left:4
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8424
            ]

            tag From47 {
                value = "dyn_dis_chg"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8000, 8088
                hide_name = True
                size = 60, 20
            ]

            tag From48 {
                value = "dyn_chg"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8000, 8120
                hide_name = True
                size = 60, 20
            ]

            junction Junction121 sp
            [
                position = 7904, 8104
            ]

            junction Junction122 sp
            [
                position = 7904, 8104
            ]

            junction Junction147 sp
            [
                position = 8392, 8080
            ]

            junction Junction160 sp
            [
                position = 8056, 8008
            ]

            junction Junction161 sp
            [
                position = 7888, 8296
            ]

            junction Junction162 sp
            [
                position = 7864, 8232
            ]

            junction Junction163 pe
            [
                position = 8120, 8192
            ]

            junction Junction164 sp
            [
                position = 8200, 8136
            ]

            connect Junction160 switch_select as Connection988
            connect Junction161 cell_temperature as Connection990
            connect Gain9.in timer as Connection989
            connect "Unit Delay6.in" script_number as Connection992
            connect Isp25.in "Multiport signal switch4.out" as Connection557
            connect Isp25.n_node current_.p_node as Connection563
            connect Integrator7.out chgAh.in as Connection565
            connect Integrator8.out disAh.in as Connection566
            connect "Multiport signal switch4.in" "1D look-up table30.value" as Connection627
            connect From47 "Multiport signal switch4.in1" as Connection638
            connect "1D look-up table30.addr" Junction121 as Connection640
            connect "1D look-up table31.addr" Junction122 as Connection643
            connect Junction122 Junction121 as Connection644
            connect "1D look-up table32.addr" Junction122 as Connection645
            connect "1D look-up table32.value" "Multiport signal switch4.in4" as Connection646
            connect "1D look-up table31.value" "Multiport signal switch4.in2" as Connection647
            connect From48 "Multiport signal switch4.in3" as Connection648
            connect Junction121 Gain9.out as Connection769
            connect "C function18.current" Gain4.out as Connection812
            connect "C function18.out" Integrator7.in as Connection813
            [
                breakpoints = 8360, 8000; 8392, 8000
            ]
            connect "C function18.out2" Integrator8.in as Connection814
            [
                breakpoints = 8360, 8064; 8392, 8064
            ]
            connect Junction147 Integrator8.reset as Connection858
            connect Integrator7.reset Junction147 as Connection859
            connect script_no.in "Unit Delay6.out" as Connection870
            connect "Unit Delay12.out" Junction147 as Connection905
            connect "Multiport signal switch4.ctrl" Junction160 as Connection981
            [
                breakpoints = 8056, 8048; 8056, 8048
            ]
            connect "Unit Delay12.in" Junction160 as Connection983
            connect temperature.in Junction161 as Connection987
            connect "Rate Transition1.in" Junction161 as Connection994
            connect voltage_.out Junction162 as Connection995
            connect Junction162 voltage_meas as Connection996
            connect voltage.in Junction162 as Connection997
            connect "Battery Cell.T" "Rate Transition1.out" as Connection999
            connect current_.n_node Junction163 as Connection1000
            connect Junction163 voltage_.p_node as Connection1001
            [
                breakpoints = 8120, 8192; 8120, 8192
            ]
            connect "Battery Cell.P" Junction163 as Connection1002
            connect voltage_.n_node "Battery Cell.N" as Connection1003
            connect Isp25.p_node "Battery Cell.N" as Connection1004
            connect Gain4.in Junction164 as Connection1006
            connect Junction164 current_.out as Connection1007
            [
                breakpoints = 8200, 8136
            ]
            connect current.in Junction164 as Connection1008
        }
        [
            position = 8744, 8464
            size = 256, 160
        ]

        component gen_c_function "C function27" {
            global_variables = "real next_sw;real counter_cooldown;real first_time_step_flag;"
            init_fnc = "/*Begin code section*/
script_no = 1;  // start with the first script
sw_select = 1;  // start with first sw permutation (1st script)
timer = 0;
counter_cooldown = counter_cooldown_max;  // wait an hour for the
// battery to go back to its original temperature [instant with typhoon] 
// and to discharge the RC capacitors
first_time_step_flag = 1;  // This flag exists because vcell measurement
// will always start with 0. We need to prevent even looking at that false vcell.
temperature = test_temp;
/*End code section*/"
            input_terminals = "real test_temp;real Vcell;"
            input_terminals_dimensions = "inherit;inherit"
            input_terminals_feedthrough = "True;True"
            input_terminals_show_labels = "True;True"
            output_fnc = "/*Begin code section*/
// The model starts immediately with time and script_no 1
// sw_select = 1
// script_no = 1

if (sw_select == 0) {
    counter_cooldown--;
    if (counter_cooldown <= 0) {
        sw_select = next_sw;
        counter_cooldown = counter_cooldown_max;
    }
}
else {  // (sw_select != 0)
    timer += Ts;
    if (Vcell < Vmin_45 && sw_select == 1 && first_time_step_flag != 1) {
        // Start second script countdown
        // Usually we would wait for the batteries and the chamber to cool off back to 25 degrees 
        script_no = 2;  // second script
        sw_select = 0;  // zero current
        next_sw = 2;
        temperature = 25;  // default temperature
        timer = 0;
    }
    else if (timer > TITHER_DISCHARGE_STOP_TIME && sw_select == 2){
        timer = 0;
        if (Vcell < Vmin_45) {
            // Start third script
            script_no = 3;
            sw_select = 3;
            temperature = test_temp;
        }
    }
    else if (Vcell > Vmax_45 && sw_select == 3) {
        // Start forth script countdown
        // Usually we would wait for the batteries and the chamber to cool off back to 25 degrees 
        script_no = 4;
        sw_select = 0;  // zero current
        next_sw = 4;
        timer = 0;
    }
    else if (timer > TITHER_CHARGE_STOP_TIME && sw_select == 4){
        timer = 0;
        if (Vcell > Vmax_45) {
            // Start forth script countdown
            // Usually we would wait for the batteries and the chamber to cool off back to 25 degrees 
            sw_select = 0;  // zero current
            script_no = 5;
            next_sw = 0;
        }
    }
}

first_time_step_flag = 0;
/*End code section*/"
            output_terminals = "real sw_select;inherit temperature;inherit timer;inherit script_no;"
            output_terminals_dimensions = "inherit;inherit;inherit;inherit"
            output_terminals_feedthrough = "True;True;True;True"
            output_terminals_show_labels = "True;True;True;True"
            parameters = "real Vmin_45;real Vmax_45;real Ts;real TITHER_CHARGE_STOP_TIME;real TITHER_DISCHARGE_STOP_TIME;real counter_cooldown_max;"
        }
        [
            position = 9136, 8088
            hide_name = True
            size = 176, 160
        ]

        component gen_c_function "C function28" {
            global_variables = "real next_sw;real first_time_step_flag;real counter_cooldown;"
            init_fnc = "/*Begin code section*/
script_no = 1;  // start with the first script
sw_select = 1;  // start with first sw permutation (1st script)
timer = 0;
counter_cooldown = counter_cooldown_max;
 // wait an \"hour\" for the
// battery to go back to its original temperature [instant with typhoon] 
// and to discharge the RC capacitors
first_time_step_flag = 1;  // This flag exists because vcell measurement
// will always start with 0. We need to prevent even looking at that false vcell.
temperature = input_temp;
/*End code section*/"
            input_terminals = "real input_temp;real Vcell;"
            input_terminals_dimensions = "inherit;inherit"
            input_terminals_feedthrough = "True;True"
            input_terminals_show_labels = "True;True"
            output_fnc = "/*Begin code section*/
if (sw_select == 0) {  // Resting the battery cell
    counter_cooldown--;
    if (counter_cooldown <= 0) {
        sw_select = next_sw;
        counter_cooldown = counter_cooldown_max;
    }
}
else {  //  (sw_select != 0) 
    timer += Ts;
    if (timer >= DYN_PROFILE_STOP_TIME && sw_select == 1){
        // This part triggers when the LUT attached to sw_select finishes with its dynamic profile
        // Consequently, the profile starts again by resetting the timer to 0
        timer = 0;
    }
    if (Vcell < V_end_script_1 && first_time_step_flag != 1 && sw_select == 1){
        // If battery cell reached less than roughly 10% of SOC, stop the dynamic profile injection
        // This is to prevent possible undervoltage with high current peaks
        sw_select = 0;
        next_sw = 2;
        temperature = 25;  // And remains so for the rest of the scripts
        script_no = 2;
    }
    else if (Vcell <= Vmin_45 && sw_select == 2){
        sw_select = 3;  // Tither profiles
        if (do_dyn_tither > 0.5){  // do dynamic tither
            timer = 0;  // Refresh timer
        }
        else {  // skip dynamic tither profiles by setting the timer to the last value
            timer = TITHER_DISCHARGE_STOP_TIME;
        }
    }
    if (timer >= TITHER_DISCHARGE_STOP_TIME && sw_select == 3){
        timer = 0;
        if (Vcell < Vmin_45) {
            // If battery cell reached less than Vmin, stop the tither profile injection
            sw_select = 4;
            script_no = 3;
            // No need to rest the battery cell
            // Constant current charging of the battery cell with C/1
        }
    }
    else if (sw_select == 4 && Vcell > Vmax_45){  // Constant current charge reached Vmax
        sw_select = 5;  // Tither profiles
        timer = 0;  // Refresh timer
    }
    else if (sw_select == 5 && timer >= TITHER_CHARGE_STOP_TIME){
        timer = 0;  // Refresh timer
        if (Vcell > Vmax_45){
            sw_select = 0;
            script_no = 4;
            next_sw = 0;
        }
    }
}

first_time_step_flag = 0;
/*End code section*/"
            output_terminals = "real sw_select;inherit temperature;inherit timer;inherit script_no;"
            output_terminals_dimensions = "inherit;inherit;inherit;inherit"
            output_terminals_feedthrough = "True;True;True;True"
            output_terminals_show_labels = "True;True;True;True"
            parameters = "real Vmin_45;real Vmax_45;real V_end_script_1;real counter_cooldown_max;real DYN_PROFILE_STOP_TIME;real TITHER_DISCHARGE_STOP_TIME;real TITHER_CHARGE_STOP_TIME;real Ts;real do_dyn_tither;"
        }
        [
            position = 9152, 8464
            hide_name = True
            size = 176, 160
        ]

        component Subsystem static_45 {
            layout = dynamic
            component "core/Voltage Measurement" voltage_ {
                execution_rate = "Ts"
                sig_output = "True"
                signal_access = "Inherit"
            }
            [
                position = 8008, 8288
                rotation = right
                scale = -1, 1
                size = 64, 32
            ]

            component gen_probe script_no {
            }
            [
                position = 7904, 8488
            ]

            component sys_mp_signal_switch "Multiport signal switch1" {
                number_of_input_terminals = "4"
            }
            [
                position = 8144, 8160
                hide_name = True
            ]

            component lut_1d "1D look-up table23" {
                in_vec_x = "TIME_TITHER_DISCHARGE"
                out_vec_f_x = "CURRENT_TITHER_DISCHARGE"
                table_impl = "Non-equidistant"
            }
            [
                position = 7920, 8160
                hide_name = True
            ]

            component lut_1d "1D look-up table25" {
                in_vec_x = "TIME_TITHER_CHARGE"
                out_vec_f_x = "CURRENT_TITHER_CHARGE"
                table_impl = "Non-equidistant"
            }
            [
                position = 7920, 8192
                hide_name = True
            ]

            component "core/Signal Controlled Current Source" Isp22 {
            }
            [
                position = 8312, 8288
                rotation = left
                hide_name = True
                scale = -1, 1
                size = 64, 32
            ]

            component "core/Current Measurement" current_ {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8248, 8256
                rotation = down
                scale = 1, -1
                size = 64, 32
            ]

            component gen_integrator Integrator1 {
                show_reset = "either"
            }
            [
                position = 8464, 8048
                hide_name = True
            ]

            component gen_probe chgAh {
            }
            [
                position = 8560, 8048
            ]

            component gen_integrator Integrator2 {
                show_reset = "either"
            }
            [
                position = 8464, 8112
                hide_name = True
            ]

            component gen_probe disAh {
            }
            [
                position = 8560, 8112
            ]

            component gen_c_function "C function2" {
                init_fnc = "/*Begin code section*/
out = 0;
out2 = 0;
/*End code section*/"
                input_terminals = "real current;"
                input_terminals_dimensions = "inherit"
                input_terminals_feedthrough = "True"
                input_terminals_show_labels = "False"
                output_fnc = "/*Begin code section*/
if (current>0) {
    out = current;
    out2 = 0;
}
else if (current<0) {
    out2 = -current;
    out = 0;
}
else {
    out2 = 0;
    out = 0;
}
/*End code section*/"
                output_terminals = "real out;inherit out2;"
                output_terminals_dimensions = "inherit;inherit"
                output_terminals_feedthrough = "True;True"
                output_terminals_show_labels = "False;False"
            }
            [
                position = 8368, 8080
                hide_name = True
                size = 48, 48
            ]

            component gen_probe temperature {
            }
            [
                position = 7952, 8408
            ]

            component gen_gain Gain2 {
                gain = "SIMULATION_SPEED_UP"
            }
            [
                position = 7824, 8176
                hide_name = True
            ]

            component gen_gain Gain3 {
                gain = "SIMULATION_SPEED_UP"
            }
            [
                position = 8304, 8080
                hide_name = True
            ]

            component tm_delay "Unit Delay1" {
            }
            [
                position = 7856, 8488
                hide_name = True
            ]

            component gen_probe current {
            }
            [
                position = 8560, 8176
            ]

            component tm_delay "Unit Delay7" {
            }
            [
                position = 8352, 8112
                hide_name = True
            ]

            component "core/Rate Transition" "Rate Transition1" {
                execution_rate = "Ts_cell"
            }
            [
                position = 8104, 8296
                hide_name = True
                size = 32, 32
            ]

            component gen_probe voltage {
            }
            [
                position = 7968, 8232
            ]

            component "core/Battery Cell" "Battery Cell" {
                C1 = "C1"
                H_type = "One state"
                M = "M"
                M0 = "M0"
                Q_total = "total_Q"
                R0 = "R0"
                R1 = "R1"
                RC_NO = "1"
                T_vector = "T_vector"
                T_vector_h = "T_vector"
                execution_rate = "Ts_cell"
                gamma = "G"
                meas_OCV = "True"
                meas_SOC = "True"
                meas_diffusion = "True"
                meas_hyst = "True"
                thermal_flag = "False"
            }
            [
                position = 8176, 8304
                size = 32, 64
            ]

            port switch_select {
                position = left:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8128
            ]

            port voltage_meas {
                position = right:3
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 7760, 8288
                rotation = down
            ]

            port timer {
                position = left:3
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8176
            ]

            port cell_temperature {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8352
            ]

            port script_number {
                position = left:4
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8488
            ]

            tag From15 {
                value = "dischg"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 7984, 8144
                hide_name = True
                size = 60, 20
            ]

            tag From16 {
                value = "chg"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 7984, 8176
                hide_name = True
                size = 60, 20
            ]

            junction Junction155 sp
            [
                position = 7984, 8128
            ]

            junction Junction156 sp
            [
                position = 7872, 8352
            ]

            junction Junction104 sp
            [
                position = 7888, 8176
            ]

            junction Junction142 sp
            [
                position = 8416, 8112
            ]

            junction Junction154 sp
            [
                position = 8248, 8176
            ]

            junction Junction157 sp
            [
                position = 7896, 8288
            ]

            junction Junction158 pe
            [
                position = 8176, 8256
            ]

            connect Gain2.in timer as Connection898
            connect "Multiport signal switch1.ctrl" Junction155 as Connection899
            connect Junction155 switch_select as Connection900
            connect "Unit Delay7.in" Junction155 as Connection901
            connect Junction156 cell_temperature as Connection907
            [
                breakpoints = 7824, 8352
            ]
            connect temperature.in Junction156 as Connection908
            connect "Unit Delay1.in" script_number as Connection909
            connect "1D look-up table23.value" "Multiport signal switch1.in1" as Connection331
            connect "1D look-up table25.value" "Multiport signal switch1.in3" as Connection332
            connect Isp22.in "Multiport signal switch1.out" as Connection337
            connect Isp22.n_node current_.p_node as Connection390
            connect Integrator1.out chgAh.in as Connection392
            connect Integrator2.out disAh.in as Connection393
            connect "C function2.out" Integrator1.in as Connection395
            connect Integrator2.in "C function2.out2" as Connection417
            connect From16 "Multiport signal switch1.in2" as Connection465
            connect Junction104 "1D look-up table23.addr" as Connection469
            connect "1D look-up table25.addr" Junction104 as Connection470
            connect Gain2.out Junction104 as Connection753
            connect "C function2.current" Gain3.out as Connection754
            connect From15 "Multiport signal switch1.in" as Connection827
            connect Junction142 Integrator1.reset as Connection838
            connect Integrator2.reset Junction142 as Connection839
            connect script_no.in "Unit Delay1.out" as Connection860
            connect Gain3.in Junction154 as Connection891
            connect Junction154 current_.out as Connection892
            [
                breakpoints = 8248, 8176
            ]
            connect current.in Junction154 as Connection893
            connect "Unit Delay7.out" Junction142 as Connection895
            connect "Rate Transition1.in" Junction156 as Connection911
            connect voltage_.out Junction157 as Connection912
            connect Junction157 voltage_meas as Connection913
            connect voltage.in Junction157 as Connection914
            connect current_.n_node Junction158 as Connection916
            connect Junction158 voltage_.p_node as Connection917
            [
                breakpoints = 8168, 8256
            ]
            connect "Battery Cell.P" Junction158 as Connection918
            connect "Battery Cell.N" voltage_.n_node as Connection919
            connect Isp22.p_node "Battery Cell.N" as Connection920
            connect "Battery Cell.T" "Rate Transition1.out" as Connection921
        }
        [
            position = 9472, 8088
            size = 248, 160
        ]

        component Subsystem dynamic_45 {
            layout = dynamic
            component "core/Voltage Measurement" voltage_ {
                execution_rate = "Ts"
                sig_output = "True"
                signal_access = "Inherit"
            }
            [
                position = 7960, 8232
                rotation = right
                scale = -1, 1
                size = 64, 32
            ]

            component sys_mp_signal_switch "Multiport signal switch4" {
                number_of_input_terminals = "5"
            }
            [
                position = 8096, 8096
                hide_name = True
            ]

            component lut_1d "1D look-up table30" {
                in_vec_x = "DYN_TIME_PROFILE"
                out_vec_f_x = "DYN_CURRENT_PROFILE"
                table_impl = "Non-equidistant"
            }
            [
                position = 7952, 8072
                hide_name = True
            ]

            component "core/Signal Controlled Current Source" Isp25 {
            }
            [
                position = 8264, 8232
                rotation = left
                hide_name = True
                scale = -1, 1
                size = 64, 32
            ]

            component "core/Current Measurement" current_ {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8200, 8192
                rotation = down
                scale = 1, -1
                size = 64, 32
            ]

            component gen_integrator Integrator7 {
                show_reset = "either"
            }
            [
                position = 8432, 8008
                hide_name = True
            ]

            component gen_probe chgAh {
            }
            [
                position = 8528, 7992
            ]

            component gen_integrator Integrator8 {
                show_reset = "either"
            }
            [
                position = 8432, 8072
                hide_name = True
            ]

            component gen_probe disAh {
            }
            [
                position = 8528, 8072
            ]

            component gen_probe script_no {
            }
            [
                position = 7944, 8424
            ]

            component lut_1d "1D look-up table31" {
                in_vec_x = "TIME_TITHER_DISCHARGE"
                out_vec_f_x = "CURRENT_TITHER_DISCHARGE"
                table_impl = "Non-equidistant"
            }
            [
                position = 7952, 8104
                hide_name = True
            ]

            component lut_1d "1D look-up table32" {
                in_vec_x = "TIME_TITHER_CHARGE"
                out_vec_f_x = "CURRENT_TITHER_CHARGE"
                table_impl = "Non-equidistant"
            }
            [
                position = 7952, 8136
                hide_name = True
            ]

            component gen_probe temperature {
            }
            [
                position = 7944, 8352
            ]

            component gen_gain Gain4 {
                gain = "SIMULATION_SPEED_UP"
            }
            [
                position = 8248, 8040
                hide_name = True
            ]

            component gen_gain Gain9 {
                gain = "SIMULATION_SPEED_UP"
            }
            [
                position = 7856, 8104
                hide_name = True
            ]

            component gen_c_function "C function18" {
                init_fnc = "/*Begin code section*/
out = 0;
out2 = 0;
/*End code section*/"
                input_terminals = "real current;"
                input_terminals_dimensions = "inherit"
                input_terminals_feedthrough = "True"
                input_terminals_show_labels = "False"
                output_fnc = "/*Begin code section*/
if (current>0) {
    out = current;
    out2 = 0;
}
else if (current<0) {
    out2 = -current;
    out = 0;
}
else {
    out2 = 0;
    out = 0;
}
/*End code section*/"
                output_terminals = "real out;inherit out2;"
                output_terminals_dimensions = "inherit;inherit"
                output_terminals_feedthrough = "True;True"
                output_terminals_show_labels = "False;False"
            }
            [
                position = 8320, 8040
                hide_name = True
                size = 48, 48
            ]

            component tm_delay "Unit Delay6" {
            }
            [
                position = 7880, 8424
                hide_name = True
            ]

            component gen_probe current {
            }
            [
                position = 8528, 8136
            ]

            component tm_delay "Unit Delay12" {
            }
            [
                position = 8344, 8088
                hide_name = True
            ]

            component "core/Rate Transition" "Rate Transition1" {
                execution_rate = "Ts_cell"
            }
            [
                position = 8048, 8232
                hide_name = True
                size = 32, 32
            ]

            component gen_probe voltage {
            }
            [
                position = 7912, 8184
            ]

            component "core/Battery Cell" "Battery Cell" {
                C1 = "C1"
                H_type = "One state"
                M = "M"
                M0 = "M0"
                Q_total = "total_Q"
                R0 = "R0"
                R1 = "R1"
                RC_NO = "1"
                T_vector = "T_vector"
                T_vector_h = "T_vector"
                execution_rate = "Ts_cell"
                gamma = "G"
                meas_OCV = "True"
                meas_SOC = "True"
                meas_diffusion = "True"
                meas_hyst = "True"
                thermal_flag = "False"
            }
            [
                position = 8128, 8240
                size = 32, 64
            ]

            port switch_select {
                position = left:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8008
            ]

            port timer {
                position = left:3
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8104
            ]

            port cell_temperature {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8296
            ]

            port voltage_meas {
                position = right:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 7760, 8232
                rotation = down
            ]

            port script_number {
                position = left:4
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8424
            ]

            tag From47 {
                value = "dyn_dis_chg"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8000, 8088
                hide_name = True
                size = 60, 20
            ]

            tag From48 {
                value = "dyn_chg"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8000, 8120
                hide_name = True
                size = 60, 20
            ]

            junction Junction121 sp
            [
                position = 7904, 8104
            ]

            junction Junction122 sp
            [
                position = 7904, 8104
            ]

            junction Junction147 sp
            [
                position = 8392, 8080
            ]

            junction Junction160 sp
            [
                position = 8056, 8008
            ]

            junction Junction161 sp
            [
                position = 7888, 8296
            ]

            junction Junction162 sp
            [
                position = 7864, 8232
            ]

            junction Junction163 pe
            [
                position = 8144, 8192
            ]

            junction Junction164 sp
            [
                position = 8200, 8128
            ]

            connect Junction160 switch_select as Connection988
            connect Junction161 cell_temperature as Connection990
            connect Gain9.in timer as Connection989
            connect "Unit Delay6.in" script_number as Connection992
            connect Isp25.in "Multiport signal switch4.out" as Connection557
            connect Isp25.n_node current_.p_node as Connection563
            connect Integrator7.out chgAh.in as Connection565
            connect Integrator8.out disAh.in as Connection566
            connect "Multiport signal switch4.in" "1D look-up table30.value" as Connection627
            connect From47 "Multiport signal switch4.in1" as Connection638
            connect "1D look-up table30.addr" Junction121 as Connection640
            connect "1D look-up table31.addr" Junction122 as Connection643
            connect Junction122 Junction121 as Connection644
            connect "1D look-up table32.addr" Junction122 as Connection645
            connect "1D look-up table32.value" "Multiport signal switch4.in4" as Connection646
            connect "1D look-up table31.value" "Multiport signal switch4.in2" as Connection647
            connect From48 "Multiport signal switch4.in3" as Connection648
            connect Junction121 Gain9.out as Connection769
            connect "C function18.current" Gain4.out as Connection812
            connect "C function18.out" Integrator7.in as Connection813
            [
                breakpoints = 8360, 8000; 8392, 8000
            ]
            connect "C function18.out2" Integrator8.in as Connection814
            [
                breakpoints = 8360, 8064; 8392, 8064
            ]
            connect Junction147 Integrator8.reset as Connection858
            connect Integrator7.reset Junction147 as Connection859
            connect script_no.in "Unit Delay6.out" as Connection870
            connect "Unit Delay12.out" Junction147 as Connection905
            connect "Multiport signal switch4.ctrl" Junction160 as Connection981
            [
                breakpoints = 8056, 8048; 8056, 8048
            ]
            connect "Unit Delay12.in" Junction160 as Connection983
            connect temperature.in Junction161 as Connection987
            connect "Rate Transition1.in" Junction161 as Connection994
            connect voltage_.out Junction162 as Connection995
            connect Junction162 voltage_meas as Connection996
            connect voltage.in Junction162 as Connection997
            connect "Battery Cell.T" "Rate Transition1.out" as Connection999
            connect current_.n_node Junction163 as Connection1000
            connect Junction163 voltage_.p_node as Connection1001
            [
                breakpoints = 8120, 8192; 8120, 8192
            ]
            connect "Battery Cell.P" Junction163 as Connection1002
            connect "Battery Cell.N" Isp25.p_node as Connection1003
            connect voltage_.n_node "Battery Cell.N" as Connection1004
            connect current_.out Junction164 as Connection1006
            connect Junction164 Gain4.in as Connection1007
            [
                breakpoints = 8200, 8136
            ]
            connect current.in Junction164 as Connection1008
        }
        [
            position = 9480, 8464
            size = 256, 160
        ]

        component gen_c_function "C function29" {
            global_variables = "real next_sw;real counter_cooldown;real first_time_step_flag;"
            init_fnc = "/*Begin code section*/
script_no = 1;  // start with the first script
sw_select = 1;  // start with first sw permutation (1st script)
timer = 0;
counter_cooldown = counter_cooldown_max;  // wait an hour for the
// battery to go back to its original temperature [instant with typhoon] 
// and to discharge the RC capacitors
first_time_step_flag = 1;  // This flag exists because vcell measurement
// will always start with 0. We need to prevent even looking at that false vcell.
temperature = test_temp;
/*End code section*/"
            input_terminals = "real test_temp;real Vcell;"
            input_terminals_dimensions = "inherit;inherit"
            input_terminals_feedthrough = "True;True"
            input_terminals_show_labels = "True;True"
            output_fnc = "/*Begin code section*/
// The model starts immediately with time and script_no 1
// sw_select = 1
// script_no = 1

if (sw_select == 0) {
    counter_cooldown--;
    if (counter_cooldown <= 0) {
        sw_select = next_sw;
        counter_cooldown = counter_cooldown_max;
    }
}
else {  // (sw_select != 0)
    timer += Ts;
    if (Vcell < Vmin_5 && sw_select == 1 && first_time_step_flag != 1) {
        // Start second script countdown
        // Usually we would wait for the batteries and the chamber to cool off back to 25 degrees 
        script_no = 2;  // second script
        sw_select = 0;  // zero current
        next_sw = 2;
        temperature = 25;  // default temperature
        timer = 0;
    }
    else if (timer > TITHER_DISCHARGE_STOP_TIME && sw_select == 2){
        timer = 0;
        if (Vcell < Vmin_5) {
            // Start third script
            script_no = 3;
            sw_select = 3;
            temperature = test_temp;
        }
    }
    else if (Vcell > Vmax_5 && sw_select == 3) {
        // Start forth script countdown
        // Usually we would wait for the batteries and the chamber to cool off back to 25 degrees 
        script_no = 4;
        sw_select = 0;  // zero current
        next_sw = 4;
        timer = 0;
    }
    else if (timer > TITHER_CHARGE_STOP_TIME && sw_select == 4){
        timer = 0;
        if (Vcell > Vmax_5) {
            // Start forth script countdown
            // Usually we would wait for the batteries and the chamber to cool off back to 25 degrees 
            sw_select = 0;  // zero current
            script_no = 5;
            next_sw = 0;
        }
    }
}

first_time_step_flag = 0;
/*End code section*/"
            output_terminals = "real sw_select;inherit temperature;inherit timer;inherit script_no;"
            output_terminals_dimensions = "inherit;inherit;inherit;inherit"
            output_terminals_feedthrough = "True;True;True;True"
            output_terminals_show_labels = "True;True;True;True"
            parameters = "real Vmin_5;real Vmax_5;real Ts;real TITHER_CHARGE_STOP_TIME;real TITHER_DISCHARGE_STOP_TIME;real counter_cooldown_max;"
        }
        [
            position = 7648, 8088
            hide_name = True
            size = 176, 160
        ]

        component gen_c_function "C function30" {
            global_variables = "real next_sw;real first_time_step_flag;real counter_cooldown;"
            init_fnc = "/*Begin code section*/
script_no = 1;  // start with the first script
sw_select = 1;  // start with first sw permutation (1st script)
timer = 0;
counter_cooldown = counter_cooldown_max;
 // wait an \"hour\" for the
// battery to go back to its original temperature [instant with typhoon] 
// and to discharge the RC capacitors
first_time_step_flag = 1;  // This flag exists because vcell measurement
// will always start with 0. We need to prevent even looking at that false vcell.
temperature = input_temp;
/*End code section*/"
            input_terminals = "real input_temp;real Vcell;"
            input_terminals_dimensions = "inherit;inherit"
            input_terminals_feedthrough = "True;True"
            input_terminals_show_labels = "True;True"
            output_fnc = "/*Begin code section*/
if (sw_select == 0) {  // Resting the battery cell
    counter_cooldown--;
    if (counter_cooldown <= 0) {
        sw_select = next_sw;
        counter_cooldown = counter_cooldown_max;
    }
}
else {  //  (sw_select != 0) 
    timer += Ts;
    if (timer >= DYN_PROFILE_STOP_TIME && sw_select == 1){
        // This part triggers when the LUT attached to sw_select finishes with its dynamic profile
        // Consequently, the profile starts again by resetting the timer to 0
        timer = 0;
    }
    if (Vcell < V_end_script_1 && first_time_step_flag != 1 && sw_select == 1){
        // If battery cell reached less than roughly 10% of SOC, stop the dynamic profile injection
        // This is to prevent possible undervoltage with high current peaks
        sw_select = 0;
        next_sw = 2;
        temperature = 25;  // And remains so for the rest of the scripts
        script_no = 2;
    }
    else if (Vcell <= Vmin_5 && sw_select == 2){
        sw_select = 3;  // Tither profiles
        if (do_dyn_tither > 0.5){  // do dynamic tither
            timer = 0;  // Refresh timer
        }
        else {  // skip dynamic tither profiles by setting the timer to the last value
            timer = TITHER_DISCHARGE_STOP_TIME;
        }
    }
    if (timer >= TITHER_DISCHARGE_STOP_TIME && sw_select == 3){
        timer = 0;
        if (Vcell < Vmin_5) {
            // If battery cell reached less than Vmin, stop the tither profile injection
            sw_select = 4;
            script_no = 3;
            // No need to rest the battery cell
            // Constant current charging of the battery cell with C/1
        }
    }
    else if (sw_select == 4 && Vcell > Vmax_5){  // Constant current charge reached Vmax
        sw_select = 5;  // Tither profiles
        timer = 0;  // Refresh timer
    }
    else if (sw_select == 5 && timer >= TITHER_CHARGE_STOP_TIME){
        timer = 0;  // Refresh timer
        if (Vcell > Vmax_5){
            sw_select = 0;
            script_no = 4;
            next_sw = 0;
        }
    }
}

first_time_step_flag = 0;
/*End code section*/"
            output_terminals = "real sw_select;inherit temperature;inherit timer;inherit script_no;"
            output_terminals_dimensions = "inherit;inherit;inherit;inherit"
            output_terminals_feedthrough = "True;True;True;True"
            output_terminals_show_labels = "True;True;True;True"
            parameters = "real Vmin_5;real Vmax_5;real V_end_script_1;real counter_cooldown_max;real DYN_PROFILE_STOP_TIME;real TITHER_DISCHARGE_STOP_TIME;real TITHER_CHARGE_STOP_TIME;real Ts;real do_dyn_tither;"
        }
        [
            position = 7664, 8464
            hide_name = True
            size = 176, 160
        ]

        component Subsystem static_5 {
            layout = dynamic
            component "core/Voltage Measurement" voltage_ {
                execution_rate = "Ts"
                sig_output = "True"
                signal_access = "Inherit"
            }
            [
                position = 8008, 8288
                rotation = right
                scale = -1, 1
                size = 64, 32
            ]

            component gen_probe script_no {
            }
            [
                position = 7904, 8488
            ]

            component sys_mp_signal_switch "Multiport signal switch1" {
                number_of_input_terminals = "4"
            }
            [
                position = 8144, 8160
                hide_name = True
            ]

            component lut_1d "1D look-up table23" {
                in_vec_x = "TIME_TITHER_DISCHARGE"
                out_vec_f_x = "CURRENT_TITHER_DISCHARGE"
                table_impl = "Non-equidistant"
            }
            [
                position = 7920, 8160
                hide_name = True
            ]

            component lut_1d "1D look-up table25" {
                in_vec_x = "TIME_TITHER_CHARGE"
                out_vec_f_x = "CURRENT_TITHER_CHARGE"
                table_impl = "Non-equidistant"
            }
            [
                position = 7920, 8192
                hide_name = True
            ]

            component "core/Signal Controlled Current Source" Isp22 {
            }
            [
                position = 8312, 8288
                rotation = left
                hide_name = True
                scale = -1, 1
                size = 64, 32
            ]

            component "core/Current Measurement" current_ {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8248, 8256
                rotation = down
                scale = 1, -1
                size = 64, 32
            ]

            component gen_integrator Integrator1 {
                show_reset = "either"
            }
            [
                position = 8464, 8048
                hide_name = True
            ]

            component gen_probe chgAh {
            }
            [
                position = 8560, 8048
            ]

            component gen_integrator Integrator2 {
                show_reset = "either"
            }
            [
                position = 8464, 8112
                hide_name = True
            ]

            component gen_probe disAh {
            }
            [
                position = 8560, 8112
            ]

            component gen_c_function "C function2" {
                init_fnc = "/*Begin code section*/
out = 0;
out2 = 0;
/*End code section*/"
                input_terminals = "real current;"
                input_terminals_dimensions = "inherit"
                input_terminals_feedthrough = "True"
                input_terminals_show_labels = "False"
                output_fnc = "/*Begin code section*/
if (current>0) {
    out = current;
    out2 = 0;
}
else if (current<0) {
    out2 = -current;
    out = 0;
}
else {
    out2 = 0;
    out = 0;
}
/*End code section*/"
                output_terminals = "real out;inherit out2;"
                output_terminals_dimensions = "inherit;inherit"
                output_terminals_feedthrough = "True;True"
                output_terminals_show_labels = "False;False"
            }
            [
                position = 8368, 8080
                hide_name = True
                size = 48, 48
            ]

            component gen_probe temperature {
            }
            [
                position = 7952, 8408
            ]

            component gen_gain Gain2 {
                gain = "SIMULATION_SPEED_UP"
            }
            [
                position = 7824, 8176
                hide_name = True
            ]

            component gen_gain Gain3 {
                gain = "SIMULATION_SPEED_UP"
            }
            [
                position = 8304, 8080
                hide_name = True
            ]

            component tm_delay "Unit Delay1" {
            }
            [
                position = 7856, 8488
                hide_name = True
            ]

            component gen_probe current {
            }
            [
                position = 8560, 8176
            ]

            component tm_delay "Unit Delay7" {
            }
            [
                position = 8352, 8112
                hide_name = True
            ]

            component "core/Rate Transition" "Rate Transition1" {
                execution_rate = "Ts_cell"
            }
            [
                position = 8096, 8296
                hide_name = True
                size = 32, 32
            ]

            component gen_probe voltage {
            }
            [
                position = 7968, 8240
            ]

            component "core/Battery Cell" "Battery Cell" {
                C1 = "C1"
                H_type = "One state"
                M = "M"
                M0 = "M0"
                Q_total = "total_Q"
                R0 = "R0"
                R1 = "R1"
                RC_NO = "1"
                T_vector = "T_vector"
                T_vector_h = "T_vector"
                execution_rate = "Ts_cell"
                gamma = "G"
                meas_OCV = "True"
                meas_SOC = "True"
                meas_diffusion = "True"
                meas_hyst = "True"
                thermal_flag = "False"
            }
            [
                position = 8176, 8304
                size = 32, 64
            ]

            port switch_select {
                position = left:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8128
            ]

            port voltage_meas {
                position = right:3
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 7760, 8288
                rotation = down
            ]

            port timer {
                position = left:3
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8176
            ]

            port cell_temperature {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8352
            ]

            port script_number {
                position = left:4
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8488
            ]

            tag From15 {
                value = "dischg"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 7984, 8144
                hide_name = True
                size = 60, 20
            ]

            tag From16 {
                value = "chg"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 7984, 8176
                hide_name = True
                size = 60, 20
            ]

            junction Junction155 sp
            [
                position = 7984, 8128
            ]

            junction Junction156 sp
            [
                position = 7872, 8352
            ]

            junction Junction104 sp
            [
                position = 7888, 8176
            ]

            junction Junction142 sp
            [
                position = 8416, 8112
            ]

            junction Junction154 sp
            [
                position = 8248, 8176
            ]

            junction Junction157 sp
            [
                position = 7896, 8288
            ]

            junction Junction158 pe
            [
                position = 8176, 8256
            ]

            connect Gain2.in timer as Connection898
            connect "Multiport signal switch1.ctrl" Junction155 as Connection899
            connect Junction155 switch_select as Connection900
            connect "Unit Delay7.in" Junction155 as Connection901
            connect Junction156 cell_temperature as Connection907
            [
                breakpoints = 7824, 8352
            ]
            connect temperature.in Junction156 as Connection908
            connect "Unit Delay1.in" script_number as Connection909
            connect "1D look-up table23.value" "Multiport signal switch1.in1" as Connection331
            connect "1D look-up table25.value" "Multiport signal switch1.in3" as Connection332
            connect Isp22.in "Multiport signal switch1.out" as Connection337
            connect Isp22.n_node current_.p_node as Connection390
            connect Integrator1.out chgAh.in as Connection392
            connect Integrator2.out disAh.in as Connection393
            connect "C function2.out" Integrator1.in as Connection395
            connect Integrator2.in "C function2.out2" as Connection417
            connect From16 "Multiport signal switch1.in2" as Connection465
            connect Junction104 "1D look-up table23.addr" as Connection469
            connect "1D look-up table25.addr" Junction104 as Connection470
            connect Gain2.out Junction104 as Connection753
            connect "C function2.current" Gain3.out as Connection754
            connect From15 "Multiport signal switch1.in" as Connection827
            connect Junction142 Integrator1.reset as Connection838
            connect Integrator2.reset Junction142 as Connection839
            connect script_no.in "Unit Delay1.out" as Connection860
            connect Gain3.in Junction154 as Connection891
            connect Junction154 current_.out as Connection892
            [
                breakpoints = 8248, 8176
            ]
            connect current.in Junction154 as Connection893
            connect "Unit Delay7.out" Junction142 as Connection895
            connect "Rate Transition1.in" Junction156 as Connection911
            connect voltage_.out Junction157 as Connection912
            connect Junction157 voltage_meas as Connection913
            connect voltage.in Junction157 as Connection914
            connect current_.n_node Junction158 as Connection916
            connect Junction158 voltage_.p_node as Connection917
            [
                breakpoints = 8168, 8256
            ]
            connect "Battery Cell.P" Junction158 as Connection918
            connect voltage_.n_node "Battery Cell.N" as Connection919
            connect Isp22.p_node "Battery Cell.N" as Connection920
            connect "Battery Cell.T" "Rate Transition1.out" as Connection921
        }
        [
            position = 7984, 8088
            size = 248, 160
        ]

        component Subsystem dynamic_5 {
            layout = dynamic
            component "core/Voltage Measurement" voltage_ {
                execution_rate = "Ts"
                sig_output = "True"
                signal_access = "Inherit"
            }
            [
                position = 7960, 8232
                rotation = right
                scale = -1, 1
                size = 64, 32
            ]

            component sys_mp_signal_switch "Multiport signal switch4" {
                number_of_input_terminals = "5"
            }
            [
                position = 8096, 8096
                hide_name = True
            ]

            component lut_1d "1D look-up table30" {
                in_vec_x = "DYN_TIME_PROFILE"
                out_vec_f_x = "DYN_CURRENT_PROFILE"
                table_impl = "Non-equidistant"
            }
            [
                position = 7952, 8072
                hide_name = True
            ]

            component "core/Signal Controlled Current Source" Isp25 {
            }
            [
                position = 8264, 8232
                rotation = left
                hide_name = True
                scale = -1, 1
                size = 64, 32
            ]

            component "core/Current Measurement" current_ {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8200, 8192
                rotation = down
                scale = 1, -1
                size = 64, 32
            ]

            component gen_integrator Integrator7 {
                show_reset = "either"
            }
            [
                position = 8432, 8008
                hide_name = True
            ]

            component gen_probe chgAh {
            }
            [
                position = 8528, 7992
            ]

            component gen_integrator Integrator8 {
                show_reset = "either"
            }
            [
                position = 8432, 8072
                hide_name = True
            ]

            component gen_probe disAh {
            }
            [
                position = 8528, 8072
            ]

            component gen_probe script_no {
            }
            [
                position = 7944, 8424
            ]

            component lut_1d "1D look-up table31" {
                in_vec_x = "TIME_TITHER_DISCHARGE"
                out_vec_f_x = "CURRENT_TITHER_DISCHARGE"
                table_impl = "Non-equidistant"
            }
            [
                position = 7952, 8104
                hide_name = True
            ]

            component lut_1d "1D look-up table32" {
                in_vec_x = "TIME_TITHER_CHARGE"
                out_vec_f_x = "CURRENT_TITHER_CHARGE"
                table_impl = "Non-equidistant"
            }
            [
                position = 7952, 8136
                hide_name = True
            ]

            component gen_probe temperature {
            }
            [
                position = 7944, 8352
            ]

            component gen_gain Gain4 {
                gain = "SIMULATION_SPEED_UP"
            }
            [
                position = 8248, 8040
                hide_name = True
            ]

            component gen_gain Gain9 {
                gain = "SIMULATION_SPEED_UP"
            }
            [
                position = 7856, 8104
                hide_name = True
            ]

            component gen_c_function "C function18" {
                init_fnc = "/*Begin code section*/
out = 0;
out2 = 0;
/*End code section*/"
                input_terminals = "real current;"
                input_terminals_dimensions = "inherit"
                input_terminals_feedthrough = "True"
                input_terminals_show_labels = "False"
                output_fnc = "/*Begin code section*/
if (current>0) {
    out = current;
    out2 = 0;
}
else if (current<0) {
    out2 = -current;
    out = 0;
}
else {
    out2 = 0;
    out = 0;
}
/*End code section*/"
                output_terminals = "real out;inherit out2;"
                output_terminals_dimensions = "inherit;inherit"
                output_terminals_feedthrough = "True;True"
                output_terminals_show_labels = "False;False"
            }
            [
                position = 8320, 8040
                hide_name = True
                size = 48, 48
            ]

            component tm_delay "Unit Delay6" {
            }
            [
                position = 7880, 8424
                hide_name = True
            ]

            component gen_probe current {
            }
            [
                position = 8528, 8136
            ]

            component tm_delay "Unit Delay12" {
            }
            [
                position = 8344, 8088
                hide_name = True
            ]

            component "core/Rate Transition" "Rate Transition1" {
                execution_rate = "Ts_cell"
            }
            [
                position = 8048, 8232
                hide_name = True
                size = 32, 32
            ]

            component gen_probe voltage {
            }
            [
                position = 7896, 8176
            ]

            component "core/Battery Cell" "Battery Cell" {
                C1 = "C1"
                H_type = "One state"
                M = "M"
                M0 = "M0"
                Q_total = "total_Q"
                R0 = "R0"
                R1 = "R1"
                RC_NO = "1"
                T_vector = "T_vector"
                T_vector_h = "T_vector"
                execution_rate = "Ts_cell"
                gamma = "G"
                meas_OCV = "True"
                meas_SOC = "True"
                meas_diffusion = "True"
                meas_hyst = "True"
                thermal_flag = "False"
            }
            [
                position = 8136, 8240
                size = 32, 64
            ]

            port switch_select {
                position = left:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8008
            ]

            port timer {
                position = left:3
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8104
            ]

            port cell_temperature {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8296
            ]

            port voltage_meas {
                position = right:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 7760, 8232
                rotation = down
            ]

            port script_number {
                position = left:4
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7760, 8424
            ]

            tag From47 {
                value = "dyn_dis_chg"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8000, 8088
                hide_name = True
                size = 60, 20
            ]

            tag From48 {
                value = "dyn_chg"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8000, 8120
                hide_name = True
                size = 60, 20
            ]

            junction Junction121 sp
            [
                position = 7904, 8104
            ]

            junction Junction122 sp
            [
                position = 7904, 8104
            ]

            junction Junction147 sp
            [
                position = 8392, 8080
            ]

            junction Junction160 sp
            [
                position = 8056, 8008
            ]

            junction Junction161 sp
            [
                position = 7888, 8296
            ]

            junction Junction162 sp
            [
                position = 7840, 8232
            ]

            junction Junction163 pe
            [
                position = 8136, 8192
            ]

            junction Junction164 sp
            [
                position = 8200, 8136
            ]

            connect Junction160 switch_select as Connection988
            connect Junction161 cell_temperature as Connection990
            connect Gain9.in timer as Connection989
            connect "Unit Delay6.in" script_number as Connection992
            connect Isp25.in "Multiport signal switch4.out" as Connection557
            connect Isp25.n_node current_.p_node as Connection563
            connect Integrator7.out chgAh.in as Connection565
            connect Integrator8.out disAh.in as Connection566
            connect "Multiport signal switch4.in" "1D look-up table30.value" as Connection627
            connect From47 "Multiport signal switch4.in1" as Connection638
            connect "1D look-up table30.addr" Junction121 as Connection640
            connect "1D look-up table31.addr" Junction122 as Connection643
            connect Junction122 Junction121 as Connection644
            connect "1D look-up table32.addr" Junction122 as Connection645
            connect "1D look-up table32.value" "Multiport signal switch4.in4" as Connection646
            connect "1D look-up table31.value" "Multiport signal switch4.in2" as Connection647
            connect From48 "Multiport signal switch4.in3" as Connection648
            connect Junction121 Gain9.out as Connection769
            connect "C function18.current" Gain4.out as Connection812
            connect "C function18.out" Integrator7.in as Connection813
            [
                breakpoints = 8360, 8000; 8392, 8000
            ]
            connect "C function18.out2" Integrator8.in as Connection814
            [
                breakpoints = 8360, 8064; 8392, 8064
            ]
            connect Junction147 Integrator8.reset as Connection858
            connect Integrator7.reset Junction147 as Connection859
            connect script_no.in "Unit Delay6.out" as Connection870
            connect "Unit Delay12.out" Junction147 as Connection905
            connect "Multiport signal switch4.ctrl" Junction160 as Connection981
            [
                breakpoints = 8056, 8048; 8056, 8048
            ]
            connect "Unit Delay12.in" Junction160 as Connection983
            connect temperature.in Junction161 as Connection987
            connect "Rate Transition1.in" Junction161 as Connection994
            connect voltage_.out Junction162 as Connection995
            connect Junction162 voltage_meas as Connection996
            connect voltage.in Junction162 as Connection997
            connect "Battery Cell.N" voltage_.n_node as Connection999
            connect Isp25.p_node "Battery Cell.N" as Connection1000
            connect current_.n_node Junction163 as Connection1001
            connect Junction163 voltage_.p_node as Connection1002
            [
                breakpoints = 8120, 8192; 8120, 8192
            ]
            connect "Battery Cell.P" Junction163 as Connection1003
            connect "Battery Cell.T" "Rate Transition1.out" as Connection1004
            connect Gain4.in Junction164 as Connection1006
            connect Junction164 current_.out as Connection1007
            [
                breakpoints = 8200, 8136
            ]
            connect current.in Junction164 as Connection1008
        }
        [
            position = 7992, 8464
            size = 256, 160
        ]

        tag Goto11 {
            value = "dischg"
            scope = global
            kind = sp
            direction = in
        }
        [
            position = 7120, 8024
            hide_name = True
            size = 60, 20
        ]

        tag Goto12 {
            value = "chg"
            scope = global
            kind = sp
            direction = in
        }
        [
            position = 7120, 8088
            hide_name = True
            size = 60, 20
        ]

        tag Goto22 {
            value = "test_temp_1"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7120, 8440
            hide_name = True
            size = 60, 20
        ]

        tag Goto23 {
            value = "test_temp_2"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7120, 8496
            hide_name = True
            size = 60, 20
        ]

        tag Goto24 {
            value = "test_temp_3"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7120, 8552
            hide_name = True
            size = 60, 20
        ]

        tag From45 {
            value = "test_temp_1"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8208, 8296
            hide_name = True
            size = 60, 20
        ]

        tag Goto29 {
            value = "dyn_dis_chg"
            scope = global
            kind = sp
            direction = in
        }
        [
            position = 7120, 8680
            hide_name = True
            size = 60, 20
        ]

        tag Goto30 {
            value = "dyn_chg"
            scope = global
            kind = sp
            direction = in
        }
        [
            position = 7120, 8744
            hide_name = True
            size = 60, 20
        ]

        tag Goto39 {
            value = "dyn_script_no_1_tag"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 8608, 8568
            hide_name = True
            size = 60, 20
        ]

        tag From63 {
            value = "dyn_script_no_1_tag"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 6960, 8256
            hide_name = True
            size = 60, 20
        ]

        tag From64 {
            value = "dyn_script_no_2_tag"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 6960, 8280
            hide_name = True
            size = 60, 20
        ]

        tag From65 {
            value = "dyn_script_no_3_tag"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 6960, 8304
            hide_name = True
            size = 60, 20
        ]

        tag Goto44 {
            value = "sta_script_no_1_tag"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 8608, 8184
            hide_name = True
            size = 60, 20
        ]

        tag From66 {
            value = "sta_script_no_1_tag"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 6960, 8176
            hide_name = True
            size = 60, 20
        ]

        tag From67 {
            value = "sta_script_no_2_tag"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 6960, 8200
            hide_name = True
            size = 60, 20
        ]

        tag From68 {
            value = "sta_script_no_3_tag"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 6960, 8224
            hide_name = True
            size = 60, 20
        ]

        tag Goto51 {
            value = "dyn_script_no_2_tag"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 9344, 8568
            hide_name = True
            size = 60, 20
        ]

        tag Goto52 {
            value = "sta_script_no_2_tag"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 9344, 8184
            hide_name = True
            size = 60, 20
        ]

        tag Goto53 {
            value = "dyn_script_no_3_tag"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7856, 8568
            hide_name = True
            size = 60, 20
        ]

        tag Goto54 {
            value = "sta_script_no_3_tag"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7856, 8184
            hide_name = True
            size = 60, 20
        ]

        tag From69 {
            value = "test_temp_2"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8936, 8288
            hide_name = True
            size = 58, 20
        ]

        tag From70 {
            value = "test_temp_3"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7448, 8280
            hide_name = True
            size = 58, 20
        ]

        junction Junction154 sp
        [
            position = 8512, 8024
        ]

        junction Junction155 sp
        [
            position = 8560, 8152
        ]

        junction Junction160 sp
        [
            position = 8568, 8400
        ]

        junction Junction161 sp
        [
            position = 8528, 8528
        ]

        junction Junction165 sp
        [
            position = 8256, 8304
        ]

        junction Junction167 sp
        [
            position = 9296, 8152
        ]

        junction Junction169 sp
        [
            position = 9264, 8528
        ]

        junction Junction171 sp
        [
            position = 7808, 8152
        ]

        junction Junction173 sp
        [
            position = 7776, 8528
        ]

        junction Junction174 sp
        [
            position = 8976, 8288
        ]

        junction Junction175 sp
        [
            position = 7496, 8280
        ]

        comment Comment5 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">STATIC TEST<br />TEMP 25 DEG  </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">DYNAMIC TEST </p></body></html> ENDCOMMENT 
        [
            position = 8504, 8240
        ]

        comment Comment7 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Unlinked to lower SOC limit</p></body></html> ENDCOMMENT 
        [
            position = 8648, 7960
        ]

        comment Comment13 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">hardcoded delay</p></body></html> ENDCOMMENT 
        [
            position = 6952, 7968
        ]

        comment Comment14 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">hardcoded delay</p></body></html> ENDCOMMENT 
        [
            position = 6960, 8624
        ]

        comment Comment19 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">STATIC TEST<br />TEMP 45 DEG  </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">DYNAMIC TEST  </p></body></html> ENDCOMMENT 
        [
            position = 9240, 8240
        ]

        comment Comment20 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Unlinked to lower SOC limit</p></body></html> ENDCOMMENT 
        [
            position = 9384, 7960
        ]

        comment Comment21 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">STATIC TEST<br />TEMP 5 DEG  </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">DYNAMIC TEST  </p></body></html> ENDCOMMENT 
        [
            position = 7752, 8240
        ]

        comment Comment22 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Unlinked to lower SOC limit</p></body></html> ENDCOMMENT 
        [
            position = 7896, 7960
        ]

        connect Time.in Gain1.out as Connection750
        connect Gain1.in Clock1.out as Connection751
        connect From66 "C function17.sta1" as Connection802
        connect "C function17.sta2" From67 as Connection803
        connect "C function17.sta3" From68 as Connection804
        connect "C function17.dyn1" From63 as Connection805
        connect "C function17.dyn2" From64 as Connection806
        connect "C function17.dyn3" From65 as Connection807
        [
            breakpoints = 7016, 8280; 7016, 8304
        ]
        connect Delay1.in "C function17.done_flag" as Connection808
        connect Delay1.out done_flag.in as Connection809
        connect STA_DIS_CHG.out Delay2.in as Connection828
        connect Delay2.out Goto11 as Connection829
        connect STA_CHG.out Delay3.in as Connection830
        connect Delay3.out Goto12 as Connection831
        connect Goto30 Delay5.out as Connection832
        connect Delay5.in DYN_CHG.out as Connection833
        connect Goto29 Delay4.out as Connection834
        connect Delay4.in DYN_DIS_CHG.out as Connection835
        connect "C function1.sw_select" Junction154 as Connection930
        connect Junction154 sw_select_1.in as Connection931
        [
            breakpoints = 8504, 8024
        ]
        connect static_25.switch_select Junction154 as Connection932
        connect static_25.cell_temperature "C function1.temperature" as Connection933
        connect static_25.timer "C function1.timer" as Connection934
        connect Goto22 TEST_TEMP_1.out as Connection954
        connect Goto23 TEST_TEMP_2.out as Connection955
        connect Goto24 TEST_TEMP_3.out as Connection956
        connect static_25.script_number Junction155 as Connection958
        connect Junction155 "C function1.script_no" as Connection959
        connect Goto44 Junction155 as Connection960
        connect "C function10.sw_select" Junction160 as Connection991
        connect Junction160 dyn_sw_select_1.in as Connection992
        [
            breakpoints = 8568, 8400; 8664, 8328; 8664, 8328
        ]
        connect dynamic_25.switch_select Junction160 as Connection993
        connect "C function10.temperature" dynamic_25.cell_temperature as Connection994
        connect "C function10.timer" dynamic_25.timer as Connection995
        connect "C function10.script_no" Junction161 as Connection996
        connect Junction161 Goto39 as Connection997
        [
            breakpoints = 8528, 8528
        ]
        connect dynamic_25.script_number Junction161 as Connection998
        connect dynamic_25.voltage_meas "C function10.Vcell" as Connection999
        [
            breakpoints = 8888, 8616; 8312, 8616
        ]
        connect static_25.voltage_meas "C function1.Vcell" as Connection1024
        [
            breakpoints = 8872, 8208; 8296, 8208
        ]
        connect "C function1.test_temp" Junction165 as Connection1026
        connect Junction165 From45 as Connection1027
        connect "C function10.input_temp" Junction165 as Connection1028
        connect static_45.cell_temperature "C function27.temperature" as Connection1032
        connect static_45.timer "C function27.timer" as Connection1033
        connect static_45.script_number Junction167 as Connection1034
        connect Junction167 "C function27.script_no" as Connection1035
        connect Goto52 Junction167 as Connection1036
        connect "C function28.temperature" dynamic_45.cell_temperature as Connection1040
        connect "C function28.timer" dynamic_45.timer as Connection1041
        connect "C function28.script_no" Junction169 as Connection1042
        connect Junction169 Goto51 as Connection1043
        [
            breakpoints = 9264, 8528
        ]
        connect dynamic_45.script_number Junction169 as Connection1044
        connect dynamic_45.voltage_meas "C function28.Vcell" as Connection1045
        [
            breakpoints = 9624, 8616; 9048, 8616
        ]
        connect static_45.voltage_meas "C function27.Vcell" as Connection1046
        [
            breakpoints = 9608, 8208; 9032, 8208
        ]
        connect static_5.cell_temperature "C function29.temperature" as Connection1050
        connect static_5.timer "C function29.timer" as Connection1051
        connect static_5.script_number Junction171 as Connection1052
        connect Junction171 "C function29.script_no" as Connection1053
        connect Goto54 Junction171 as Connection1054
        connect "C function30.temperature" dynamic_5.cell_temperature as Connection1058
        connect "C function30.timer" dynamic_5.timer as Connection1059
        connect "C function30.script_no" Junction173 as Connection1060
        connect Junction173 Goto53 as Connection1061
        [
            breakpoints = 7776, 8528
        ]
        connect dynamic_5.script_number Junction173 as Connection1062
        connect dynamic_5.voltage_meas "C function30.Vcell" as Connection1063
        [
            breakpoints = 8136, 8616; 7560, 8616
        ]
        connect static_5.voltage_meas "C function29.Vcell" as Connection1064
        [
            breakpoints = 8120, 8208; 7544, 8208
        ]
        connect "C function27.test_temp" Junction174 as Connection1066
        connect Junction174 From69 as Connection1067
        connect "C function28.input_temp" Junction174 as Connection1068
        connect From70 Junction175 as Connection1070
        connect Junction175 "C function29.test_temp" as Connection1071
        [
            breakpoints = 7496, 8280; 7496, 8024
        ]
        connect "C function30.input_temp" Junction175 as Connection1072
        connect dynamic_45.switch_select "C function28.sw_select" as Connection1073
        [
            breakpoints = 9304, 8400
        ]
        connect "C function27.sw_select" static_45.switch_select as Connection1074
        [
            breakpoints = 9248, 8024
        ]
        connect "C function29.sw_select" static_5.switch_select as Connection1075
        [
            breakpoints = 7760, 8024
        ]
        connect "C function30.sw_select" dynamic_5.switch_select as Connection1076
        [
            breakpoints = 7816, 8400
        ]
    }

    logically_deleted {
        "Comment5"
        "Comment19"
        "Comment21"
    }

    default {
        gen_c_function {
            input_terminals = "real in;"
            input_terminals_show_labels = "False;"
            input_terminals_feedthrough = "True;"
            input_terminals_dimensions = "inherit;"
            output_terminals = "real out;"
            output_terminals_show_labels = "False;"
            output_terminals_feedthrough = "True;"
            output_terminals_dimensions = "inherit;"
            output_fnc = ""
            update_fnc = ""
            init_fnc = ""
            global_variables = ""
            parameters = ""
            execution_rate = "inherit"
        }

        gen_delay {
            delay_type = "Fixed delay"
            del_length = "2"
            max_delay_length = "20"
            init_value = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        gen_gain {
            gain = "1"
            multiplication = "Element-wise(K.*u)"
            _tunable = "False"
            execution_rate = "inherit"
        }

        gen_integrator {
            show_reset = "none"
            reset_type = "asynchronous"
            show_init_condition = "internal"
            init_value = "0"
            limit_output = "False"
            limit_upper = "inf"
            limit_lower = "-inf"
            show_state = "False"
            state_port_type = "inherit"
            execution_rate = "inherit"
        }

        gen_probe {
            signal_access = "inherit"
            addr = "0"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "generic"
            streaming_en = "False"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        lut_1d {
            in_vec_x = "np.arange(-5,6)"
            out_vec_f_x = "np.arange(-5,6)**2"
            table_impl = "Equidistant"
            ext_mode = "Clip"
            execution_rate = "inherit"
        }

        src_clock {
            enb_reset = "False"
            reset_at = "1.0"
            execution_rate = "100e-6"
        }

        src_constant {
            value = "1"
            signal_type = "real"
            execution_rate = "100e-6"
            _tunable = "False"
        }

        sys_mp_signal_switch {
            number_of_input_terminals = "2"
            execution_rate = "inherit"
        }

        tm_delay {
            init_value = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        "core/Battery Cell" {
            SOC_vector = "[0.00000, 0.00500, 0.01000, 0.01500, 0.02000, 0.02500, 0.03000, 0.03500, 0.04000, 0.04500, 0.05000, 0.05500, 0.06000, 0.06500, 0.07000, 0.07500, 0.08000, 0.08500, 0.09000, 0.09500, 0.10000, 0.10500, 0.11000, 0.11500, 0.12000, 0.12500, 0.13000, 0.13500, 0.14000, 0.14500, 0.15000, 0.15500, 0.16000, 0.16500, 0.17000, 0.17500, 0.18000, 0.18500, 0.19000, 0.19500, 0.20000, 0.20500, 0.21000, 0.21500, 0.22000, 0.22500, 0.23000, 0.23500, 0.24000, 0.24500, 0.25000, 0.25500, 0.26000, 0.26500, 0.27000, 0.27500, 0.28000, 0.28500, 0.29000, 0.29500, 0.30000, 0.30500, 0.31000, 0.31500, 0.32000, 0.32500, 0.33000, 0.33500, 0.34000, 0.34500, 0.35000, 0.35500, 0.36000, 0.36500, 0.37000, 0.37500, 0.38000, 0.38500, 0.39000, 0.39500, 0.40000, 0.40500, 0.41000, 0.41500, 0.42000, 0.42500, 0.43000, 0.43500, 0.44000, 0.44500, 0.45000, 0.45500, 0.46000, 0.46500, 0.47000, 0.47500, 0.48000, 0.48500, 0.49000, 0.49500, 0.50000, 0.50500, 0.51000, 0.51500, 0.52000, 0.52500, 0.53000, 0.53500, 0.54000, 0.54500, 0.55000, 0.55500, 0.56000, 0.56500, 0.57000, 0.57500, 0.58000, 0.58500, 0.59000, 0.59500, 0.60000, 0.60500, 0.61000, 0.61500, 0.62000, 0.62500, 0.63000, 0.63500, 0.64000, 0.64500, 0.65000, 0.65500, 0.66000, 0.66500, 0.67000, 0.67500, 0.68000, 0.68500, 0.69000, 0.69500, 0.70000, 0.70500, 0.71000, 0.71500, 0.72000, 0.72500, 0.73000, 0.73500, 0.74000, 0.74500, 0.75000, 0.75500, 0.76000, 0.76500, 0.77000, 0.77500, 0.78000, 0.78500, 0.79000, 0.79500, 0.80000, 0.80500, 0.81000, 0.81500, 0.82000, 0.82500, 0.83000, 0.83500, 0.84000, 0.84500, 0.85000, 0.85500, 0.86000, 0.86500, 0.87000, 0.87500, 0.88000, 0.88500, 0.89000, 0.89500, 0.90000, 0.90500, 0.91000, 0.91500, 0.92000, 0.92500, 0.93000, 0.93500, 0.94000, 0.94500, 0.95000, 0.95500, 0.96000, 0.96500, 0.97000, 0.97500, 0.98000, 0.98500, 0.99000, 0.99500, 1.00000]"
            Init_SOC = "100"
            SOH_vector = "0"
            T_vector = "[5, 25, 45]"
            OCV = "[[ 2.81376455, 2.934249, 3.01131295, 3.0707406, 3.12232055, 3.1679386999999997, 3.20864785, 3.2450991, 3.27819715, 3.30856405, 3.3362725999999996, 3.3618633499999997, 3.38570235, 3.40775795, 3.42830425, 3.4476403500000004, 3.4655972, 3.48235125, 3.4982734000000004, 3.5123286499999997, 3.52428065, 3.5322503000000003, 3.536190725, 3.538614355, 3.5410027349999997, 3.543410505, 3.54570155, 3.548176695, 3.55074616, 3.55332738, 3.5560948150000002, 3.5590690300000003, 3.5622155269999998, 3.5656399850000002, 3.569116135, 3.5732180099999997, 3.57727722, 3.5820934199999996, 3.58702369, 3.5923769, 3.5981162299999996, 3.60387865, 3.6098619999999997, 3.61578425, 3.6219618000000002, 3.6279250050000003, 3.633843695, 3.6400532699999997, 3.646100845, 3.6525218749999997, 3.659006475, 3.6658932699999998, 3.6723717, 3.67845187, 3.6843657899999998, 3.690319095, 3.696598375, 3.70317101, 3.7103087649999997, 3.71751191, 3.72478503, 3.7312556949999998, 3.737126875, 3.7421215, 3.746753425, 3.7512470799999997, 3.7557191, 3.759948005, 3.7641692570000003, 3.7683243400000004, 3.77226982, 3.776130865, 3.77996065, 3.7834905, 3.78724775, 3.79068595, 3.79405435, 3.79739885, 3.8008169, 3.8037784, 3.80672915, 3.80976375, 3.81294495, 3.8155956, 3.81841755, 3.8211345, 3.82375915, 3.826463, 3.8289732, 3.83148675, 3.8339139, 3.8364958500000004, 3.8389766, 3.84130125, 3.8436186, 3.84593155, 3.8484112, 3.8508698999999997, 3.853017, 3.8553768, 3.8575925, 3.8597776, 3.8618757, 3.8639596, 3.8662289, 3.8684966, 3.8704239, 3.8727584, 3.8746679, 3.8767636000000003, 3.8789283, 3.88108645, 3.88336145, 3.88554035, 3.8876272999999997, 3.88979185, 3.8919731499999997, 3.89423455, 3.89660415, 3.89878675, 3.9010609, 3.9034554999999997, 3.9058273, 3.9083077999999998, 3.9107870499999997, 3.9134431, 3.91605185, 3.9188395000000003, 3.92173155, 3.9245562, 3.9278719, 3.93123635, 3.93501795, 3.9392118, 3.9434215, 3.9476625, 3.9522793, 3.956863, 3.9614228, 3.9661213500000003, 3.97056845, 3.97496085, 3.97923145, 3.98304985, 3.9867527999999997, 3.990355, 3.9938599000000004, 3.997107, 4.0001812, 4.0032136000000005, 4.0059932, 4.0087594499999994, 4.011432500000001, 4.0139152, 4.0163138, 4.0185217, 4.02070895, 4.022900900000001, 4.0249913, 4.0268188, 4.02872455, 4.03070295, 4.0323274, 4.0341031, 4.03572435, 4.0374238, 4.03904715, 4.0406617, 4.0421721999999995, 4.04385255, 4.04555215, 4.0469809, 4.048781399999999, 4.05039585, 4.052104, 4.05390415, 4.0557043, 4.057513849999999, 4.0593374, 4.0614338, 4.0635322, 4.0657283, 4.0680112, 4.0704244, 4.07274935, 4.075507399999999, 4.0782211, 4.0812930000000005, 4.08431865, 4.08759685, 4.0910807, 4.0947777499999995, 4.0989474, 4.10329865, 4.10799, 4.1129271, 4.1185746, 4.1244995, 4.1311105999999995, 4.138731625, 4.14890576], [2.8100227500000003, 2.916445, 2.99576475, 3.057303, 3.11000275, 3.1564935, 3.19803925, 3.2350955, 3.26858575, 3.2992202500000003, 3.3273629999999996, 3.35331675, 3.37731175, 3.39958975, 3.4203212499999998, 3.4398017500000004, 3.457986, 3.47495625, 3.4909670000000004, 3.50564325, 3.51860325, 3.5288515, 3.535353625, 3.539071775, 3.5418136749999998, 3.544252525, 3.54650775, 3.5488834750000002, 3.5513308, 3.5538369, 3.556474075, 3.55934515, 3.5622776349999996, 3.565399925, 3.5687806749999997, 3.57249005, 3.5763861, 3.5808671, 3.5855184500000004, 3.5906845, 3.5961811499999996, 3.60179325, 3.60771, 3.6137212499999998, 3.619809, 3.626025025, 3.632018475, 3.63826635, 3.644504225, 3.6510093749999997, 3.657832375, 3.66466635, 3.6710585, 3.67705935, 3.6830289499999997, 3.689195475, 3.6957918750000003, 3.70265505, 3.709943825, 3.71715955, 3.72392515, 3.729878475, 3.735234375, 3.7402075, 3.744967125, 3.7498354, 3.7545954999999998, 3.759340025, 3.764046285, 3.7688217, 3.7733491, 3.777854325, 3.78220325, 3.7862525, 3.7902387500000003, 3.79382975, 3.79747175, 3.80099425, 3.8044845, 3.807692, 3.81084575, 3.81401875, 3.81712475, 3.819978, 3.82288775, 3.8256725, 3.82839575, 3.831115, 3.833666, 3.83623375, 3.8387695, 3.8412792500000004, 3.843683, 3.84610625, 3.848493, 3.85085775, 3.853256, 3.8555495, 3.857885, 3.860084, 3.8623624999999997, 3.864488, 3.8665785, 3.868598, 3.8707445, 3.872883, 3.8749195, 3.876992, 3.8789395, 3.881018, 3.8830415, 3.88503225, 3.88720725, 3.88930175, 3.8913365, 3.89335925, 3.8954657499999996, 3.89757275, 3.89982075, 3.90193375, 3.9041045000000003, 3.9064775, 3.9087365, 3.911139, 3.91353525, 3.9160155, 3.91865925, 3.9213975000000003, 3.92425775, 3.927181, 3.9305595, 3.93418175, 3.93828975, 3.942859, 3.9479075, 3.9531125, 3.9585965, 3.9639149999999996, 3.968714, 3.97340675, 3.9776422499999997, 3.98160425, 3.98535725, 3.98884925, 3.992164, 3.995375, 3.9984995000000003, 4.001535, 4.004506, 4.007268, 4.0099659999999995, 4.01259725, 4.015162500000001, 4.017576, 4.019969, 4.0222085, 4.02434475, 4.026504500000001, 4.0285565, 4.030494, 4.03242275, 4.03431475, 4.036036999999999, 4.0377155, 4.03942175, 4.041119, 4.04283575, 4.0445085, 4.046061, 4.047662750000001, 4.04936075, 4.050904500000001, 4.052707, 4.05437925, 4.05612, 4.05792075, 4.0597215, 4.06156925, 4.063487, 4.065569, 4.067661, 4.0698415, 4.072056, 4.074522, 4.07694675, 4.079536999999999, 4.0823055, 4.085265000000001, 4.08839325, 4.0915842499999995, 4.0950035, 4.09868875, 4.102737, 4.106893250000001, 4.11155, 4.1162355, 4.1216729999999995, 4.1272975, 4.133553, 4.140458125, 4.149328799999999], [2.80628095, 2.898641, 2.98021655, 3.0438654, 3.09768495, 3.1450483, 3.18743065, 3.2250919, 3.2589743500000004, 3.2898764500000004, 3.3184533999999997, 3.34477015, 3.36892115, 3.39142155, 3.41233825, 3.43196315, 3.4503747999999996, 3.46756125, 3.4836606000000003, 3.4989578499999996, 3.5129258500000002, 3.5254527, 3.534516525, 3.539529195, 3.542624615, 3.545094545, 3.54731395, 3.549590255, 3.55191544, 3.55434642, 3.556853335, 3.55962127, 3.562339743, 3.565159865, 3.568445215, 3.57176209, 3.57549498, 3.5796407799999996, 3.58401321, 3.5889921, 3.5942460699999996, 3.59970785, 3.605558, 3.6116582499999996, 3.6176562, 3.624125045, 3.630193255, 3.63647943, 3.642907605, 3.6494968749999996, 3.656658275, 3.66343943, 3.6697452999999998, 3.67566683, 3.6816921099999997, 3.688071855, 3.694985375, 3.70213909, 3.709578885, 3.71680719, 3.72306527, 3.728501255, 3.7333418750000003, 3.7382934999999997, 3.743180825, 3.74842372, 3.7534718999999996, 3.758732045, 3.7639233130000003, 3.7693190600000004, 3.77442838, 3.779577785, 3.78444585, 3.7890145, 3.79322975, 3.7969735499999997, 3.80088915, 3.80458965, 3.8081521, 3.8116056, 3.81496235, 3.81827375, 3.8213045500000002, 3.8243603999999998, 3.82735795, 3.8302104999999997, 3.83303235, 3.8357669999999997, 3.8383588, 3.84098075, 3.8436251, 3.8460626500000004, 3.8483894000000003, 3.8509112500000002, 3.8533674, 3.85578395, 3.8581008, 3.8602290999999997, 3.862753, 3.8647912, 3.8671325, 3.8691984, 3.8712813, 3.8732364, 3.8752600999999998, 3.8772694, 3.8794151, 3.8812256, 3.8832111, 3.8852724000000003, 3.8871547, 3.88897805, 3.89105305, 3.8930631499999997, 3.8950457, 3.89692665, 3.8989583499999996, 3.90091095, 3.90303735, 3.90508075, 3.9071481, 3.9094995, 3.9116457000000002, 3.9139702, 3.91628345, 3.9185879, 3.92126665, 3.9239555, 3.92678395, 3.9298058, 3.9332471, 3.93712715, 3.9415615500000003, 3.9465062, 3.9523935, 3.9585624999999998, 3.9649137, 3.970967, 3.9760052, 3.9806921500000003, 3.98471605, 3.98824765, 3.99148305, 3.99464865, 3.9975752, 4.000395, 4.0031391, 4.005963, 4.0088308, 4.0113224, 4.0139388, 4.016435049999999, 4.018892500000001, 4.0212368, 4.0236241999999995, 4.0258953, 4.02798055, 4.0301081000000005, 4.032121699999999, 4.0341692, 4.03612095, 4.03792655, 4.0397466, 4.0413279, 4.04311915, 4.0448142, 4.04662435, 4.0483553, 4.0499498, 4.05147295, 4.05316935, 4.0548281, 4.0566325999999995, 4.05836265, 4.060136, 4.06193735, 4.0637387, 4.06562465, 4.0676366, 4.069704199999999, 4.0717898, 4.0739547, 4.0761008, 4.0786196, 4.08114415, 4.083566599999999, 4.0863899, 4.089237000000001, 4.09246785, 4.09557165, 4.0989263, 4.1025997499999995, 4.1065266, 4.11048785, 4.11511, 4.1195439, 4.1247714, 4.1300955, 4.1359954, 4.1421846250000005, 4.1497518399999995]]"
            R0 = "[4.6198e-3, 1.7810e-3, 1.1351e-3]"
            eta = "[0.98174, 0.99102, 0.98965]"
            cell_NO = "1"
            nom_Q_combo = "Total capacity"
            Q_discharge = "[14.592, 14.532, 14.444]"
            V_min = "2.81"
            I_dis = "15"
            Q_total = "[14.592, 14.532, 14.444]"
            execution_rate = "100e-6"
            visualize_luts = "Visualize Lookup Tables"
            RC_NO = "None"
            R1 = "8e-3"
            C1 = "60e3"
            R2 = "8e-3"
            C2 = "120e3"
            R3 = "8e-3"
            C3 = "180e3"
            T_vector_diff = "0"
            SOH_vector_diff = "0"
            H_type = "None"
            T_vector_h = "[5, 25, 45]"
            SOC_vector_h = "0"
            M0 = "[0.0031315, 0.0023535, 0.0011502]"
            M = "[0.039929, 0.020018, 0.020545]"
            gamma = "[67.207, 92.645, 67.840]"
            visualize_luts2 = "Visualize Lookup Tables"
            balancing = "None"
            R_balance = "10"
            thermal_flag = "True"
            Rth = "3.40"
            Cth = "17.65"
            cell_temp_init = "25"
            meas_SOH = "False"
            meas_SOC = "False"
            meas_OCV = "False"
            meas_Rint = "False"
            meas_Q = "False"
            meas_Ibal = "False"
            meas_Icell = "False"
            meas_T = "False"
            meas_hyst = "False"
            meas_diffusion = "False"
        }

        "core/Current Measurement" {
            signal_access = "inherit"
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            sig_output_filt_and_full_bw = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/Rate Transition" {
            init_value = "0.0"
            execution_rate = "100e-6"
        }

        "core/Signal Controlled Current Source" {
            execution_rate = "inherit"
        }

        "core/Voltage Measurement" {
            signal_access = "inherit"
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            sig_output_filt_and_full_bw = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }
    }

    CODE model_init
        R1 = 0.004
        C1 = 150.0
        M0 = [1e-05, 1e-05, 1e-05]
        M = [1e-05, 1e-05, 1e-05]
        R0 = [0.0046198, 0.001781, 0.0011351]
        T_vector = [5, 25, 45]
        SIMULATION_SPEED_UP = 100
        init_dynamic = 100  # 90% initial state of charge for dynamic scripts so that the voltage doesnt go over Vmax
        Ts = 0.01
        Ts_cell = 0.002
        G = [67.207, 92.645, 67.84]  # G param is wrong for default battery
        do_dyn_tither = 0  # dynamic tither makes no sense if there is no hysteresis
        
        rest_time_for_temperature_equilibrium = 7200/SIMULATION_SPEED_UP  # 7200s or 2h
        counter_cooldown_max = rest_time_for_temperature_equilibrium/Ts
        counter_cooldown_max = counter_cooldown_max/SIMULATION_SPEED_UP
        
        OCV = [[ 2.81376455, 2.934249, 3.01131295, 3.0707406, 3.12232055, 3.1679386999999997, 3.20864785, 3.2450991, 3.27819715, 3.30856405, 3.3362725999999996, 3.3618633499999997, 3.38570235, 3.40775795, 3.42830425, 3.4476403500000004, 3.4655972, 3.48235125, 3.4982734000000004, 3.5123286499999997, 3.52428065, 3.5322503000000003, 3.536190725, 3.538614355, 3.5410027349999997, 3.543410505, 3.54570155, 3.548176695, 3.55074616, 3.55332738, 3.5560948150000002, 3.5590690300000003, 3.5622155269999998, 3.5656399850000002, 3.569116135, 3.5732180099999997, 3.57727722, 3.5820934199999996, 3.58702369, 3.5923769, 3.5981162299999996, 3.60387865, 3.6098619999999997, 3.61578425, 3.6219618000000002, 3.6279250050000003, 3.633843695, 3.6400532699999997, 3.646100845, 3.6525218749999997, 3.659006475, 3.6658932699999998, 3.6723717, 3.67845187, 3.6843657899999998, 3.690319095, 3.696598375, 3.70317101, 3.7103087649999997, 3.71751191, 3.72478503, 3.7312556949999998, 3.737126875, 3.7421215, 3.746753425, 3.7512470799999997, 3.7557191, 3.759948005, 3.7641692570000003, 3.7683243400000004, 3.77226982, 3.776130865, 3.77996065, 3.7834905, 3.78724775, 3.79068595, 3.79405435, 3.79739885, 3.8008169, 3.8037784, 3.80672915, 3.80976375, 3.81294495, 3.8155956, 3.81841755, 3.8211345, 3.82375915, 3.826463, 3.8289732, 3.83148675, 3.8339139, 3.8364958500000004, 3.8389766, 3.84130125, 3.8436186, 3.84593155, 3.8484112, 3.8508698999999997, 3.853017, 3.8553768, 3.8575925, 3.8597776, 3.8618757, 3.8639596, 3.8662289, 3.8684966, 3.8704239, 3.8727584, 3.8746679, 3.8767636000000003, 3.8789283, 3.88108645, 3.88336145, 3.88554035, 3.8876272999999997, 3.88979185, 3.8919731499999997, 3.89423455, 3.89660415, 3.89878675, 3.9010609, 3.9034554999999997, 3.9058273, 3.9083077999999998, 3.9107870499999997, 3.9134431, 3.91605185, 3.9188395000000003, 3.92173155, 3.9245562, 3.9278719, 3.93123635, 3.93501795, 3.9392118, 3.9434215, 3.9476625, 3.9522793, 3.956863, 3.9614228, 3.9661213500000003, 3.97056845, 3.97496085, 3.97923145, 3.98304985, 3.9867527999999997, 3.990355, 3.9938599000000004, 3.997107, 4.0001812, 4.0032136000000005, 4.0059932, 4.0087594499999994, 4.011432500000001, 4.0139152, 4.0163138, 4.0185217, 4.02070895, 4.022900900000001, 4.0249913, 4.0268188, 4.02872455, 4.03070295, 4.0323274, 4.0341031, 4.03572435, 4.0374238, 4.03904715, 4.0406617, 4.0421721999999995, 4.04385255, 4.04555215, 4.0469809, 4.048781399999999, 4.05039585, 4.052104, 4.05390415, 4.0557043, 4.057513849999999, 4.0593374, 4.0614338, 4.0635322, 4.0657283, 4.0680112, 4.0704244, 4.07274935, 4.075507399999999, 4.0782211, 4.0812930000000005, 4.08431865, 4.08759685, 4.0910807, 4.0947777499999995, 4.0989474, 4.10329865, 4.10799, 4.1129271, 4.1185746, 4.1244995, 4.1311105999999995, 4.138731625, 4.14890576], 
        [2.8100227500000003, 2.916445, 2.99576475, 3.057303, 3.11000275, 3.1564935, 3.19803925, 3.2350955, 3.26858575, 3.2992202500000003, 3.3273629999999996, 3.35331675, 3.37731175, 3.39958975, 3.4203212499999998, 3.4398017500000004, 3.457986, 3.47495625, 3.4909670000000004, 3.50564325, 3.51860325, 3.5288515, 3.535353625, 3.539071775, 3.5418136749999998, 3.544252525, 3.54650775, 3.5488834750000002, 3.5513308, 3.5538369, 3.556474075, 3.55934515, 3.5622776349999996, 3.565399925, 3.5687806749999997, 3.57249005, 3.5763861, 3.5808671, 3.5855184500000004, 3.5906845, 3.5961811499999996, 3.60179325, 3.60771, 3.6137212499999998, 3.619809, 3.626025025, 3.632018475, 3.63826635, 3.644504225, 3.6510093749999997, 3.657832375, 3.66466635, 3.6710585, 3.67705935, 3.6830289499999997, 3.689195475, 3.6957918750000003, 3.70265505, 3.709943825, 3.71715955, 3.72392515, 3.729878475, 3.735234375, 3.7402075, 3.744967125, 3.7498354, 3.7545954999999998, 3.759340025, 3.764046285, 3.7688217, 3.7733491, 3.777854325, 3.78220325, 3.7862525, 3.7902387500000003, 3.79382975, 3.79747175, 3.80099425, 3.8044845, 3.807692, 3.81084575, 3.81401875, 3.81712475, 3.819978, 3.82288775, 3.8256725, 3.82839575, 3.831115, 3.833666, 3.83623375, 3.8387695, 3.8412792500000004, 3.843683, 3.84610625, 3.848493, 3.85085775, 3.853256, 3.8555495, 3.857885, 3.860084, 3.8623624999999997, 3.864488, 3.8665785, 3.868598, 3.8707445, 3.872883, 3.8749195, 3.876992, 3.8789395, 3.881018, 3.8830415, 3.88503225, 3.88720725, 3.88930175, 3.8913365, 3.89335925, 3.8954657499999996, 3.89757275, 3.89982075, 3.90193375, 3.9041045000000003, 3.9064775, 3.9087365, 3.911139, 3.91353525, 3.9160155, 3.91865925, 3.9213975000000003, 3.92425775, 3.927181, 3.9305595, 3.93418175, 3.93828975, 3.942859, 3.9479075, 3.9531125, 3.9585965, 3.9639149999999996, 3.968714, 3.97340675, 3.9776422499999997, 3.98160425, 3.98535725, 3.98884925, 3.992164, 3.995375, 3.9984995000000003, 4.001535, 4.004506, 4.007268, 4.0099659999999995, 4.01259725, 4.015162500000001, 4.017576, 4.019969, 4.0222085, 4.02434475, 4.026504500000001, 4.0285565, 4.030494, 4.03242275, 4.03431475, 4.036036999999999, 4.0377155, 4.03942175, 4.041119, 4.04283575, 4.0445085, 4.046061, 4.047662750000001, 4.04936075, 4.050904500000001, 4.052707, 4.05437925, 4.05612, 4.05792075, 4.0597215, 4.06156925, 4.063487, 4.065569, 4.067661, 4.0698415, 4.072056, 4.074522, 4.07694675, 4.079536999999999, 4.0823055, 4.085265000000001, 4.08839325, 4.0915842499999995, 4.0950035, 4.09868875, 4.102737, 4.106893250000001, 4.11155, 4.1162355, 4.1216729999999995, 4.1272975, 4.133553, 4.140458125, 4.149328799999999], 
        [2.80628095, 2.898641, 2.98021655, 3.0438654, 3.09768495, 3.1450483, 3.18743065, 3.2250919, 3.2589743500000004, 3.2898764500000004, 3.3184533999999997, 3.34477015, 3.36892115, 3.39142155, 3.41233825, 3.43196315, 3.4503747999999996, 3.46756125, 3.4836606000000003, 3.4989578499999996, 3.5129258500000002, 3.5254527, 3.534516525, 3.539529195, 3.542624615, 3.545094545, 3.54731395, 3.549590255, 3.55191544, 3.55434642, 3.556853335, 3.55962127, 3.562339743, 3.565159865, 3.568445215, 3.57176209, 3.57549498, 3.5796407799999996, 3.58401321, 3.5889921, 3.5942460699999996, 3.59970785, 3.605558, 3.6116582499999996, 3.6176562, 3.624125045, 3.630193255, 3.63647943, 3.642907605, 3.6494968749999996, 3.656658275, 3.66343943, 3.6697452999999998, 3.67566683, 3.6816921099999997, 3.688071855, 3.694985375, 3.70213909, 3.709578885, 3.71680719, 3.72306527, 3.728501255, 3.7333418750000003, 3.7382934999999997, 3.743180825, 3.74842372, 3.7534718999999996, 3.758732045, 3.7639233130000003, 3.7693190600000004, 3.77442838, 3.779577785, 3.78444585, 3.7890145, 3.79322975, 3.7969735499999997, 3.80088915, 3.80458965, 3.8081521, 3.8116056, 3.81496235, 3.81827375, 3.8213045500000002, 3.8243603999999998, 3.82735795, 3.8302104999999997, 3.83303235, 3.8357669999999997, 3.8383588, 3.84098075, 3.8436251, 3.8460626500000004, 3.8483894000000003, 3.8509112500000002, 3.8533674, 3.85578395, 3.8581008, 3.8602290999999997, 3.862753, 3.8647912, 3.8671325, 3.8691984, 3.8712813, 3.8732364, 3.8752600999999998, 3.8772694, 3.8794151, 3.8812256, 3.8832111, 3.8852724000000003, 3.8871547, 3.88897805, 3.89105305, 3.8930631499999997, 3.8950457, 3.89692665, 3.8989583499999996, 3.90091095, 3.90303735, 3.90508075, 3.9071481, 3.9094995, 3.9116457000000002, 3.9139702, 3.91628345, 3.9185879, 3.92126665, 3.9239555, 3.92678395, 3.9298058, 3.9332471, 3.93712715, 3.9415615500000003, 3.9465062, 3.9523935, 3.9585624999999998, 3.9649137, 3.970967, 3.9760052, 3.9806921500000003, 3.98471605, 3.98824765, 3.99148305, 3.99464865, 3.9975752, 4.000395, 4.0031391, 4.005963, 4.0088308, 4.0113224, 4.0139388, 4.016435049999999, 4.018892500000001, 4.0212368, 4.0236241999999995, 4.0258953, 4.02798055, 4.0301081000000005, 4.032121699999999, 4.0341692, 4.03612095, 4.03792655, 4.0397466, 4.0413279, 4.04311915, 4.0448142, 4.04662435, 4.0483553, 4.0499498, 4.05147295, 4.05316935, 4.0548281, 4.0566325999999995, 4.05836265, 4.060136, 4.06193735, 4.0637387, 4.06562465, 4.0676366, 4.069704199999999, 4.0717898, 4.0739547, 4.0761008, 4.0786196, 4.08114415, 4.083566599999999, 4.0863899, 4.089237000000001, 4.09246785, 4.09557165, 4.0989263, 4.1025997499999995, 4.1065266, 4.11048785, 4.11511, 4.1195439, 4.1247714, 4.1300955, 4.1359954, 4.1421846250000005, 4.1497518399999995]]
        
        Vmin_5 = min(OCV[0])  # Volts
        Vmin_25 = min(OCV[1]) # Volts
        Vmin_45 = min(OCV[2]) # Volts
        Vmax_5 = max(OCV[0])  # Volts
        Vmax_25 = max(OCV[1]) # Volts
        Vmax_45 = max(OCV[2]) # Volts
        
        total_Q_original = [14.592, 14.532, 14.444]
        total_Q = [i/SIMULATION_SPEED_UP for i in total_Q_original]
        
        C = 14.532  # C rate of a battery is current that will empty the cell in one hour
        DISCHG_RATE =  0.5 # 0.5 if its normal battery discharge speed
        CHG_RATE = -DISCHG_RATE
        
        # when the dynamic script executes, current profiles don't push the cell voltage
        # over the intended Vmax
        V_end_script_1 = (Vmax_5-Vmin_5)*0.01+Vmin_5  # ends dynamic script 1 when SOC is roughly at 10%
        DYN_DIS_CHG = C/30
        DYN_CHG = -C
        print(V_end_script_1)
        info(V_end_script_1)
        
        import pickle
        # model_path = mdl.get_model_file_path()
        filename = 'c:\\PROJECT\\battery_cell_testing\\scripts_and_data\\current_profiles.pickle'
        file = open(filename, 'rb')
        current_profiles_dict = pickle.load(file)
        
        TIME_TITHER_DISCHARGE      = current_profiles_dict['TIME_TITHER_DISCHARGE']
        TIME_TITHER_CHARGE         = current_profiles_dict['TIME_TITHER_CHARGE']
        CURRENT_TITHER_DISCHARGE   = current_profiles_dict['CURRENT_TITHER_DISCHARGE']
        CURRENT_TITHER_CHARGE      = current_profiles_dict['CURRENT_TITHER_CHARGE']
        TITHER_DISCHARGE_STOP_TIME = current_profiles_dict['TITHER_DISCHARGE_STOP_TIME']
        TITHER_CHARGE_STOP_TIME    = current_profiles_dict['TITHER_CHARGE_STOP_TIME']
        
        DYN_TIME_PROFILE           = current_profiles_dict['DYN_TIME_PROFILE']
        DYN_CURRENT_PROFILE        = current_profiles_dict['DYN_CURRENT_PROFILE']
        DYN_PROFILE_STOP_TIME      = current_profiles_dict['DYN_PROFILE_STOP_TIME']
        
        # Tither profiles are assumed to be the same for dynamic scripts as well as for 
        # the static scripts, check later
        
        TITHER_DISCHARGE_STOP_TIME       = TITHER_DISCHARGE_STOP_TIME /SIMULATION_SPEED_UP
        TITHER_CHARGE_STOP_TIME          = TITHER_CHARGE_STOP_TIME    /SIMULATION_SPEED_UP
        DYN_PROFILE_STOP_TIME            = DYN_PROFILE_STOP_TIME      /SIMULATION_SPEED_UP
        
    ENDCODE
}
